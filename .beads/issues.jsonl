{"id":"railyard-07g","title":"Dashboard HTTP server and embedded asset foundation","description":"Set up the foundational HTTP server, routing, and embedded asset infrastructure for the Railyard dashboard.\n\n## What to build\n- Create internal/dashboard/ package with:\n  - server.go: HTTP server setup, ListenAndServe, graceful shutdown\n  - routes.go: route registration (/, /cars, /cars/{id}, /engines, /engines/{id}, /messages, /api/events for SSE)\n  - assets/: directory for static files (CSS, HTMX JS library)\n  - templates/: directory for Go html/template files\n  - embed.go: go:embed directives for assets/ and templates/ directories\n- Create cmd/ry/dashboard.go: ry dashboard command\n  - --port flag (default 8080)\n  - --config/-c flag for railyard.yaml\n  - Connects to Dolt DB via config, passes gorm.DB to handlers\n  - Prints \"Dashboard running at http://localhost:8080\" on start\n  - Graceful shutdown on SIGINT/SIGTERM\n\n## Routing structure\n- GET / — dashboard overview (redirect or serve main page)\n- GET /cars — car list with query params (?track=\u0026status=\u0026type=)\n- GET /cars/{id} — car detail\n- GET /engines — engine list (could be part of dashboard)\n- GET /engines/{id} — engine detail\n- GET /messages — message list\n- GET /api/events — SSE endpoint (implemented in later task, just register route)\n- GET /static/* — embedded static assets\n\n## Tech details\n- Use Go stdlib net/http with http.ServeMux (Go 1.22+ supports method+path patterns)\n- Embed HTMX JS (download htmx.min.js ~14KB into assets/)\n- Minimal CSS file in assets/ (can use Pico CSS ~10KB for classless styling or hand-roll)\n- Base template layout with nav, content area, and alert placeholder\n\n## Acceptance criteria\n- [ ] internal/dashboard/ package compiles and exports a Start(opts) function\n- [ ] ry dashboard -c railyard.yaml starts HTTP server on configured port\n- [ ] GET / returns 200 with HTML containing base layout\n- [ ] GET /static/htmx.min.js returns 200 with correct content-type\n- [ ] GET /static/style.css returns 200\n- [ ] Server shuts down cleanly on SIGINT\n- [ ] All routes return 200 (can be placeholder \"coming soon\" pages initially)\n- [ ] Tests: server starts and responds on /, static assets served, unknown routes return 404\n- [ ] No external runtime dependencies (all assets embedded)","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-17T02:03:40Z","created_by":"Chris Trower","updated_at":"2026-02-17T13:19:16Z","closed_at":"2026-02-17T13:19:16Z","close_reason":"Dashboard foundation built with Gin framework: HTTP server, embedded HTMX+CSS assets, Go templates, all route stubs, SSE endpoint stub, CLI command with --port flag. 12 dashboard tests + 3 CLI tests passing."}
{"id":"railyard-0mu","title":"Engine sends done message instead of using ry complete command","description":"## Bug\nEngine agent sends a message with subject \"car-9921f done\" to yardmaster instead of running ry complete \u003ccar-id\u003e. Yardmaster logs \"unknown subject\" and acks it without acting. The car may or may not get marked done depending on whether the engine also ran the correct command.\n\n## Root Cause\nEngine instructions in context.go say to use ry car complete but don't strongly warn against messaging for completion. The agent improvises with a message.\n\n## Fix\n1. Make engine instructions more explicit: show the command in a code block, add bold warning not to send messages for completion\n2. Add a catch in Yardmaster daemon for subjects containing \"done\" or \"complete\" — log a clear warning that engines should use ry complete instead","status":"closed","priority":1,"issue_type":"bug","owner":"chris.trower@outlook.com","created_at":"2026-02-17T04:06:04Z","created_by":"Chris Trower","updated_at":"2026-02-17T04:06:10Z","closed_at":"2026-02-17T04:06:10Z","close_reason":"Fixed engine instructions to strongly warn against messaging for completion, added catch in Yardmaster daemon for done/complete subjects with clear warning log"}
{"id":"railyard-28w","title":"Update dispatch prompt with standardized yardmaster action subjects","description":"Replace the 'Engine Management' section in internal/dispatch/prompt.go promptTemplate with a 'Communicating with Yardmaster' section that documents the standardized action subjects. Dispatch (Claude agent) must use these exact subjects so yardmaster can route them to handlers.\n\nStandard subjects to document:\n- restart-engine: engine stuck/unresponsive, include --car-id\n- retry-merge: human fixed issues, ready to merge again, include --car-id\n- requeue-car: needs to be reworked from scratch, include --car-id\n- nudge-engine: send guidance to engine working on a car, include --car-id\n- unblock-car: manually unblock a blocked car, include --car-id\n\nEach entry should show the full ry message send command with example --body text.\n\nFiles: internal/dispatch/prompt.go (MODIFY)\n\nTest requirements:\n- go test ./internal/dispatch/ -v passes (existing prompt render tests)\n- Prompt output contains all 5 action subjects\n- go build ./cmd/ry/ compiles","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-17T02:08:00Z","created_by":"Chris Trower","updated_at":"2026-02-17T02:19:27Z","closed_at":"2026-02-17T02:19:27Z","close_reason":"Replaced free-form engine management section with standardized action subjects: restart-engine, retry-merge, requeue-car, nudge-engine, unblock-car with examples"}
{"id":"railyard-2ky","title":"Write unit tests for yardmaster action handlers","description":"Create internal/yardmaster/actions_test.go with unit tests for all handler functions. Tests cannot use a real DB (unit test build tag), so they should test the logic paths with mocks or use the existing test helper patterns from daemon_test.go and health_test.go.\n\nTests:\n- TestHandleRestartEngine_NoCarID — empty CarID logs warning and returns without action\n- TestHandleRetryMerge_SetsStatusDone — car with status 'blocked' transitions to 'done'\n- TestHandleRetryMerge_CarNotFound — handles missing car gracefully\n- TestHandleRequeueCar_SetsStatusOpen — car status set to 'open', assignee cleared\n- TestHandleRequeueCar_WritesProgressNote — CarProgress record created with reason from msg.Body\n- TestHandleNudgeEngine_ForwardsGuidance — guidance message sent to engine assigned to the car\n- TestHandleNudgeEngine_NoEngineAssigned — handles car with no assigned engine gracefully\n- TestHandleUnblockCar_SetsStatusOpen — car transitions blocked-\u003eopen\n- TestHandleUnblockCar_NotBlocked — handles car that isn't blocked gracefully\n\nFiles: internal/yardmaster/actions_test.go (NEW)\n\nTest requirements:\n- All tests pass: go test ./internal/yardmaster/ -v -run TestHandle\n- go vet ./... clean\n- Full suite: go test ./... -count=1","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-17T02:08:10Z","created_by":"Chris Trower","updated_at":"2026-02-17T02:21:04Z","closed_at":"2026-02-17T02:21:04Z","close_reason":"Created actions_test.go with 11 tests covering all 5 handlers: empty CarID validation, output prefix format, and table-driven test for skip behavior","dependencies":[{"issue_id":"railyard-2ky","depends_on_id":"railyard-5wk","type":"blocks","created_at":"2026-02-16T20:09:18Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-2ky","depends_on_id":"railyard-blu","type":"blocks","created_at":"2026-02-16T20:09:18Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-2u9","title":"Add ry logs CLI command with tail/follow support","description":"Add a 'ry logs' command to view agent log output from the agent_logs table in Dolt. Should support:\n\n- ry logs -- show recent logs across all engines\n- ry logs --engine \u003cid\u003e -- filter to a specific engine\n- ry logs --bead \u003cid\u003e -- filter to a specific bead\n- ry logs --follow / -f -- tail mode, poll for new entries and stream them (like tail -f)\n- ry logs --lines \u003cn\u003e / -n \u003cn\u003e -- number of recent entries to show (default 20)\n- ry logs --raw -- show full content (default truncates to preview)\n\nOutput should parse the stream-json content and display a human-readable summary: timestamp, engine, bead, direction, and a truncated preview of the content. In --raw mode, show full content.\n\nFor --follow mode, poll the agent_logs table every 2-3 seconds for new entries (track last seen ID), and print new entries as they arrive.\n\nDatabase connection info comes from railyard.yaml config (dolt host/port) and the database name pattern railyard_{owner}.","status":"closed","priority":2,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T22:12:02Z","created_by":"Chris Trower","updated_at":"2026-02-15T23:00:12Z","closed_at":"2026-02-15T23:00:12Z","close_reason":"Implemented ry logs command with filtering, --follow, and --raw modes"}
{"id":"railyard-39f","title":"Railyard Dashboard — Read-only Web UI","description":"Read-only local web dashboard for monitoring Railyard status in real-time. Replaces the need to repeatedly run ry status or watch tmux panes.\n\n## Architecture\n- internal/dashboard/ package: HTTP server, handlers, query functions, embedded HTML templates\n- cmd/ry/dashboard.go: ry dashboard CLI command (--port flag, default 8080)\n- Go html/template for server-rendered pages\n- HTMX for live partial-page updates (polling every 3-5s)\n- SSE (Server-Sent Events) endpoint for push notifications on human escalations\n- All static assets (HTMX JS ~14KB, CSS) embedded via go:embed — ships in the single ry binary\n\n## Pages\n1. Dashboard (landing): engines table, track summaries, car counts by status, message queue depth\n2. Car list: filterable by track/status/type, links to detail\n3. Car detail: all fields, progress history, dependency graph, children\n4. Engine detail: status, current car link, recent activity\n5. Messages: list with escalation highlighting, priority badges\n6. Live updates: HTMX auto-refresh on dashboard sections + SSE alert banner for human escalations\n\n## Design Decisions\n- Go templates + HTMX over React SPA: stdlib-first, no build step, embedded in binary\n- SSE for escalations over WebSocket: lightweight push, no full duplex needed\n- Embedded assets over file serving: single binary, no path issues\n- Separate ry dashboard command: keep optional, can integrate into ry start later\n\n## Constraints\n- Read-only: no commands or write operations through the UI\n- Lightweight: no JS build pipeline, no node dependency\n- Local only: localhost, no auth needed\n- Data source: same Dolt DB via GORM","status":"closed","priority":1,"issue_type":"epic","owner":"chris.trower@outlook.com","created_at":"2026-02-17T02:03:22Z","created_by":"Chris Trower","updated_at":"2026-02-17T13:42:53Z","closed_at":"2026-02-17T13:42:53Z","close_reason":"All dashboard pages complete: main dashboard, car list/detail, engine detail, messages, SSE endpoint. 35 tests passing."}
{"id":"railyard-3q8","title":"Fix dispatch to be interactive instead of fire-and-forget","description":"Dispatch currently launches Claude with `-p` flag which makes it a one-shot prompt that processes once and exits. The system prompt says 'Monitor for incoming feature requests' but Claude cannot actually monitor anything — it runs once and the tmux pane goes idle.\n\nThe intended purpose (per ARCHITECTURE.md) is that Dispatch is 'the user's primary interface' for decomposing feature requests into beads. This requires an interactive session, not a fire-and-forget.\n\n**Current behavior:** `ry dispatch` runs `claude --dangerously-skip-permissions --system-prompt \u003cprompt\u003e -p \u003cone-shot\u003e` → Claude responds once → process exits → tmux pane idle.\n\n**Desired behavior:** Dispatch should be an interactive Claude session the user can attach to and converse with. Options:\n1. Drop the `-p` flag and launch `claude` interactively (user attaches to tmux pane)\n2. Use a CLAUDE.md with the dispatch prompt instead of `--system-prompt` so the session has persistent context\n3. Potentially use `--stdin` for programmatic interaction\n\n**Files:** `internal/dispatch/dispatch.go`, `internal/dispatch/prompt.go`, `cmd/ry/dispatch.go`","status":"closed","priority":2,"issue_type":"bug","owner":"chris.trower@outlook.com","created_at":"2026-02-16T03:19:14Z","created_by":"Chris Trower","updated_at":"2026-02-16T03:22:01Z","closed_at":"2026-02-16T03:22:01Z","close_reason":"Removed -p flag making dispatch interactive. Switched to --append-system-prompt and connected stdin."}
{"id":"railyard-3yn","title":"Verify Go 1.25 download URL in quickstart.sh","description":"go.mod specifies go 1.25.0 and quickstart.sh tries to download go1.25.0.linux-amd64.tar.gz. The curl uses -fsSL which suppresses errors on 404. If Go 1.25 isn't released, the download silently fails. Add error checking on the curl and verify the URL is valid.","status":"closed","priority":2,"issue_type":"bug","owner":"chris.trower@outlook.com","created_at":"2026-02-15T20:11:52Z","created_by":"Chris Trower","updated_at":"2026-02-16T20:26:45Z","closed_at":"2026-02-16T20:26:45Z","close_reason":"Closed"}
{"id":"railyard-55e","title":"Dashboard main page — overview layout and live data","description":"Build the main dashboard landing page showing a real-time overview of the Railyard instance. This is the primary page users will have open on a second monitor.\n\n## What to build\n- internal/dashboard/handlers.go (or dashboard_handler.go): handler for GET /\n- internal/dashboard/queries.go: query functions that gather dashboard data from GORM\n  - EngineSummary(db) — all engines with status, track, current car, uptime, last activity\n  - TrackSummary(db) — per-track car counts grouped by status (draft, open, ready, claimed, in_progress, done, blocked)\n  - MessageQueueDepth(db) — count of unacknowledged non-broadcast messages\n  - RecentEscalations(db) — recent messages to \"human\" agent, unacknowledged\n- templates/dashboard.html: main page template extending base layout\n\n## Dashboard sections\n1. **Header**: Railyard instance info (owner, repo)\n2. **Engines table**: ID (link to /engines/{id}), Track, Status (color-coded: green=working, gray=idle, yellow=stalled, red=dead), Current Car (link to /cars/{id}), Last Activity (relative time), Uptime\n3. **Track summary cards**: One card per track showing: track name, car counts by status as a simple bar or badges (draft, open, ready, in_progress, done, blocked), total active engines\n4. **Escalation alert area**: Banner at top if there are unacknowledged human escalations — \"N escalation(s) need attention\" with link to /messages?priority=urgent\n5. **Message queue**: Small indicator showing unacknowledged message count\n\n## HTMX integration\n- Wrap each section in a div with hx-get=\"/partials/engines\" hx-trigger=\"every 3s\" hx-swap=\"innerHTML\"\n- Create partial template endpoints: GET /partials/engines, /partials/tracks, /partials/alerts\n- Partials return HTML fragments (no full page), HTMX swaps them in-place\n- This gives live dashboard updates with zero custom JavaScript\n\n## Acceptance criteria\n- [ ] GET / renders full dashboard page with all sections populated from DB\n- [ ] Engines table shows all engines with correct status, links to detail pages\n- [ ] Track summary shows correct car counts per status per track\n- [ ] Escalation banner appears when unacknowledged human messages exist\n- [ ] HTMX partials auto-refresh every 3s without full page reload\n- [ ] Page looks reasonable with minimal CSS (readable tables, color-coded statuses)\n- [ ] Tests: query functions return expected data shapes, handler returns 200 with expected HTML fragments, partial endpoints return valid HTML\n- [ ] No N+1 query problems (use appropriate JOINs or batch queries)","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-17T02:07:23Z","created_by":"Chris Trower","updated_at":"2026-02-17T13:25:17Z","closed_at":"2026-02-17T13:25:17Z","close_reason":"Dashboard main page with live data: queries (EngineSummary, TrackSummary, MessageQueueDepth, RecentEscalations), HTMX partials auto-refreshing every 3s, engines table, track cards, escalation banner. 18 tests passing.","dependencies":[{"issue_id":"railyard-55e","depends_on_id":"railyard-07g","type":"blocks","created_at":"2026-02-16T20:10:34Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-575","title":"Configurable acceptance criteria and per-car skip-tests flag","description":"Added default_acceptance to railyard.yaml config that gets injected into the Dispatch prompt instead of hardcoded 90% test coverage. Added skip_tests bool to Car model so individual cars can skip the Yardmaster test gate. Updated Dispatch prompt, Yardmaster switch logic, and CLI commands.","status":"closed","priority":1,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-17T01:23:04Z","created_by":"Chris Trower","updated_at":"2026-02-17T01:23:11Z","closed_at":"2026-02-17T01:23:11Z","close_reason":"Implemented: default_acceptance config, skip_tests on Car model, --skip-tests CLI flag, Yardmaster respects skip_tests, Dispatch prompt uses configurable acceptance criteria"}
{"id":"railyard-5ll","title":"Bead Management — CLI CRUD \u0026 Dependency Tracking","description":"Full bead lifecycle through the ry CLI. Adds business logic for creating, querying, and managing beads — the core work unit in Railyard. Critical deliverable: ReadyBeads() query (ARCHITECTURE.md Section 2) used by engine daemon to find claimable work. Bead IDs are short hashes (be-a1b2c). Branch names follow ry/{owner}/{track}/{bead_id}. Builds on Epic 1 GORM models and database layer. See IMPLEMENTATION_PLAN.md Epic 2.","design":"See ARCHITECTURE.md Section 2 (Schema) for GORM operations: ClaimBead(), CompleteBead(), ReadyBeads()","acceptance_criteria":"Create epic with child tasks, set dependency chains. ry bead ready --track backend returns only unblocked beads. Full CRUD via CLI (create, list, show, update). Status transitions validated. \u003e90% test coverage for internal/bead/.","status":"closed","priority":0,"issue_type":"epic","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:01:48Z","created_by":"Chris Trower","updated_at":"2026-02-15T04:49:46Z","closed_at":"2026-02-15T04:49:46Z","close_reason":"All children complete: CRUD, deps, hierarchy, 90.5% test coverage","labels":["bead-mgmt","phase-1"],"dependencies":[{"issue_id":"railyard-5ll","depends_on_id":"railyard-d88","type":"blocks","created_at":"2026-02-14T20:03:03Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-5ll.1","title":"Bead CRUD Operations","description":"internal/bead/ package providing Create, Get, List, Update functions plus CLI commands. Bead IDs are auto-generated 5-char hex hashes with be- prefix. Status defaults to open. Branch auto-computed as ry/{owner}/{track}/{id}. CLI commands are the primary bead management interface before Dispatch is built.","acceptance_criteria":"Create/Get/List/Update functions work via GORM. CLI commands ry bead create/list/show/update functional. ID generation produces unique be-xxxxx format. Branch names computed correctly. Status transitions validated. \u003e90% test coverage for CRUD operations.","status":"closed","priority":0,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:05Z","created_by":"Chris Trower","updated_at":"2026-02-15T04:19:27Z","closed_at":"2026-02-15T04:19:27Z","close_reason":"All CRUD operations + CLI commands implemented with 93.3% test coverage","labels":["bead-mgmt","crud","phase-1"],"dependencies":[{"issue_id":"railyard-5ll.1","depends_on_id":"railyard-5ll","type":"parent-child","created_at":"2026-02-14T20:02:04Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-5ll.1","depends_on_id":"railyard-d88.4","type":"blocks","created_at":"2026-02-14T20:03:11Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-5ll.1.1","title":"Implement bead package core functions","description":"Create internal/bead/bead.go with: Create(db *gorm.DB, opts CreateOpts) (*models.Bead, error) — generates ID (5-char hex, be- prefix), sets status=open, computes branch=ry/{owner}/{track}/{id}. Get(db, id) (*models.Bead, error) — preloads Deps and Progress. List(db, filters ListFilters) ([]models.Bead, error) — filters by track, status, type, assignee. Update(db, id, updates) error — validates status transitions. ID uniqueness check on create.","acceptance_criteria":"Create generates unique IDs. Get returns full bead with relations. List filters correctly. Update validates transitions. Branch name format correct. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:05Z","created_by":"Chris Trower","updated_at":"2026-02-15T04:19:22Z","closed_at":"2026-02-15T04:19:22Z","close_reason":"Implemented bead CRUD package + CLI commands with \u003e93% test coverage","labels":["bead-mgmt","crud","phase-1"],"dependencies":[{"issue_id":"railyard-5ll.1.1","depends_on_id":"railyard-5ll.1","type":"parent-child","created_at":"2026-02-14T20:02:05Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-5ll.1.2","title":"Implement ry bead create CLI command","description":"Cobra subcommand: ry bead create --title '...' --track backend --type task --priority 2 --description '...' --acceptance '...' --design '...'. Required: title, track. Defaults: type=task, priority=2, status=open. Prints created bead ID and branch name on success. Loads config for owner/branch_prefix.","acceptance_criteria":"Command creates bead in Dolt. Prints ID and branch. Required field validation. Defaults applied. Queryable via mysql after creation. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:06Z","created_by":"Chris Trower","updated_at":"2026-02-15T04:19:22Z","closed_at":"2026-02-15T04:19:22Z","close_reason":"Implemented bead CRUD package + CLI commands with \u003e93% test coverage","labels":["bead-mgmt","crud","phase-1"],"dependencies":[{"issue_id":"railyard-5ll.1.2","depends_on_id":"railyard-5ll.1","type":"parent-child","created_at":"2026-02-14T20:02:06Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-5ll.1.3","title":"Implement ry bead list and ry bead show","description":"ry bead list with filters: --track, --status, --type, --assignee. Table-formatted output showing ID, title, status, track, priority, assignee. ry bead show \u003cid\u003e — full detail view including description, acceptance, design notes, progress entries, dependencies, parent info, branch name, timestamps.","acceptance_criteria":"List shows filtered results in table format. Show displays all bead fields. Empty results handled gracefully. Invalid ID returns clear error. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:07Z","created_by":"Chris Trower","updated_at":"2026-02-15T04:19:22Z","closed_at":"2026-02-15T04:19:22Z","close_reason":"Implemented bead CRUD package + CLI commands with \u003e93% test coverage","labels":["bead-mgmt","crud","phase-1"],"dependencies":[{"issue_id":"railyard-5ll.1.3","depends_on_id":"railyard-5ll.1","type":"parent-child","created_at":"2026-02-14T20:02:06Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-5ll.1.4","title":"Implement ry bead update with status validation","description":"ry bead update \u003cid\u003e --status claimed --assignee engine-01 --priority 1 --description '...' etc. Status transition validation: valid transitions are open→ready, ready→claimed, claimed→in_progress, in_progress→done, open→cancelled, any→blocked. Invalid transitions return error with explanation of valid transitions from current state.","acceptance_criteria":"Update modifies fields in Dolt. Invalid status transitions rejected with helpful error. Multiple fields updatable in one command. Non-existent ID returns error. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:08Z","created_by":"Chris Trower","updated_at":"2026-02-15T04:19:22Z","closed_at":"2026-02-15T04:19:22Z","close_reason":"Implemented bead CRUD package + CLI commands with \u003e93% test coverage","labels":["bead-mgmt","crud","phase-1"],"dependencies":[{"issue_id":"railyard-5ll.1.4","depends_on_id":"railyard-5ll.1","type":"parent-child","created_at":"2026-02-14T20:02:07Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-5ll.2","title":"Dependency Management \u0026 Ready Detection","description":"Blocking relationships between beads and the critical ReadyBeads() query. A bead is 'ready' when status=open AND all blockers are done/cancelled. This query (ARCHITECTURE.md Section 2) is the foundation of engine daemon work selection. Dependencies stored in bead_deps table.","acceptance_criteria":"Dependencies created/listed/removed. ReadyBeads() returns correct beads (only those with all blockers resolved). Cycle detection prevents circular deps. Self-dependency prevented. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:08Z","created_by":"Chris Trower","updated_at":"2026-02-15T04:31:36Z","closed_at":"2026-02-15T04:31:36Z","close_reason":"All dependency management and ready detection implemented","labels":["bead-mgmt","deps","phase-1"],"dependencies":[{"issue_id":"railyard-5ll.2","depends_on_id":"railyard-5ll","type":"parent-child","created_at":"2026-02-14T20:02:08Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-5ll.2","depends_on_id":"railyard-5ll.1","type":"blocks","created_at":"2026-02-14T20:03:12Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-5ll.2.1","title":"Implement bead dependency functions","description":"Create internal/bead/deps.go with: AddDep(db, beadID, blockedBy, depType string) error — creates bead_deps row, validates both IDs exist, prevents self-dependency, detects simple cycles. ListDeps(db, beadID) (blockers []BeadDep, dependents []BeadDep, error) — returns what blocks this bead AND what this bead blocks. RemoveDep(db, beadID, blockedBy) error — deletes dependency row.","acceptance_criteria":"AddDep creates valid dependency. Self-dep returns error. Simple cycle (A→B→A) detected. ListDeps returns both directions. RemoveDep works. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:09Z","created_by":"Chris Trower","updated_at":"2026-02-15T04:31:35Z","closed_at":"2026-02-15T04:31:35Z","close_reason":"Implemented deps + ReadyBeads + CLI commands with 92.7% coverage","labels":["bead-mgmt","deps","phase-1"],"dependencies":[{"issue_id":"railyard-5ll.2.1","depends_on_id":"railyard-5ll.2","type":"parent-child","created_at":"2026-02-14T20:02:09Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-5ll.2.2","title":"Implement ry bead dep CLI commands","description":"ry bead dep add \u003cbead\u003e --blocked-by \u003cblocker\u003e — creates blocking dependency. ry bead dep list \u003cbead\u003e — shows what blocks this bead and what this bead blocks, formatted as table. ry bead dep remove \u003cbead\u003e --blocked-by \u003cblocker\u003e — removes dependency.","acceptance_criteria":"CLI commands map to dep functions correctly. Output formatted clearly. Invalid IDs return helpful errors. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:10Z","created_by":"Chris Trower","updated_at":"2026-02-15T04:31:35Z","closed_at":"2026-02-15T04:31:35Z","close_reason":"Implemented deps + ReadyBeads + CLI commands with 92.7% coverage","labels":["bead-mgmt","deps","phase-1"],"dependencies":[{"issue_id":"railyard-5ll.2.2","depends_on_id":"railyard-5ll.2","type":"parent-child","created_at":"2026-02-14T20:02:09Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-5ll.2.3","title":"Implement ReadyBeads query and ry bead ready","description":"ReadyBeads(db *gorm.DB, track string) ([]models.Bead, error) — exactly per ARCHITECTURE.md Section 2: SELECT beads WHERE track=X AND status=open AND assignee IS NULL AND id NOT IN (SELECT bead_id FROM bead_deps JOIN beads blocker ON blocked_by=blocker.id WHERE blocker.status NOT IN ('done','cancelled')). Ordered by priority ASC, created_at ASC. ry bead ready --track backend — CLI wrapper listing ready beads.","acceptance_criteria":"ReadyBeads returns only beads with all blockers done/cancelled. Beads with no deps and status=open are ready. Priority ordering correct. ry bead ready displays results. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:11Z","created_by":"Chris Trower","updated_at":"2026-02-15T04:31:35Z","closed_at":"2026-02-15T04:31:35Z","close_reason":"Implemented deps + ReadyBeads + CLI commands with 92.7% coverage","labels":["bead-mgmt","deps","phase-1"],"dependencies":[{"issue_id":"railyard-5ll.2.3","depends_on_id":"railyard-5ll.2","type":"parent-child","created_at":"2026-02-14T20:02:10Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-5ll.3","title":"Bead Hierarchy (Epics \u0026 Parents)","description":"Parent-child relationships for organizing beads. Epics are parent beads containing child tasks/features. Uses ParentID field on Bead model. Supports listing children of a parent with status summary.","acceptance_criteria":"Epic creation works. Child beads link to parent via ParentID. ry bead children shows all children with status. Parent validation on create. \u003e90% test coverage.","status":"closed","priority":1,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:11Z","created_by":"Chris Trower","updated_at":"2026-02-15T04:44:33Z","closed_at":"2026-02-15T04:44:33Z","close_reason":"Implemented parent validation, --parent flag, children command, show enhancement, track inheritance, and tests","labels":["bead-mgmt","hierarchy","phase-1"],"dependencies":[{"issue_id":"railyard-5ll.3","depends_on_id":"railyard-5ll","type":"parent-child","created_at":"2026-02-14T20:02:11Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-5ll.3","depends_on_id":"railyard-5ll.2","type":"blocks","created_at":"2026-02-14T20:03:13Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-5ll.3.1","title":"Implement parent-child relationships and CLI","description":"ry bead create --type epic --title '...' --track backend creates epic. ry bead create --type task --parent \u003cepic-id\u003e --title '...' creates child linked via ParentID. ry bead children \u003cparent-id\u003e lists all children with status summary (count by status). Validate parent exists on create. Children inherit track from parent if not specified.","acceptance_criteria":"Epic created with type=epic. Child links to parent. Children command shows summary. Invalid parent ID returns error. Track inheritance works. \u003e90% test coverage.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:12Z","created_by":"Chris Trower","updated_at":"2026-02-15T05:58:35Z","closed_at":"2026-02-15T05:58:35Z","close_reason":"All acceptance criteria verified: epic creation, parent-child linking, children command, parent validation, track inheritance, and tests all implemented","labels":["bead-mgmt","hierarchy","phase-1"],"dependencies":[{"issue_id":"railyard-5ll.3.1","depends_on_id":"railyard-5ll.3","type":"parent-child","created_at":"2026-02-14T20:02:12Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-5ll.4","title":"Bead Management Test Suite","description":"Comprehensive tests for all bead operations. \u003e90% coverage for internal/bead/. Unit tests for ID generation, status validation, cycle detection. Integration tests with Dolt for CRUD, dependencies, and ready detection.","acceptance_criteria":"\u003e90% line coverage for internal/bead/. All unit and integration tests pass. Edge cases covered (empty results, cancelled blockers, cross-track deps).","status":"closed","priority":1,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:13Z","created_by":"Chris Trower","updated_at":"2026-02-15T04:49:36Z","closed_at":"2026-02-15T04:49:36Z","close_reason":"90.5% coverage achieved with existing unit and integration tests","labels":["bead-mgmt","phase-1","testing"],"dependencies":[{"issue_id":"railyard-5ll.4","depends_on_id":"railyard-5ll","type":"parent-child","created_at":"2026-02-14T20:02:12Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-5ll.4","depends_on_id":"railyard-5ll.3","type":"blocks","created_at":"2026-02-14T20:03:14Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-5ll.4.1","title":"Unit tests for bead operations","description":"internal/bead/bead_test.go. Test: ID generation produces unique 5-char hex with be- prefix (generate 1000, check uniqueness). Status transition validation (all valid transitions succeed, invalid transitions fail with descriptive error). Cycle detection (A→B→A detected, A→B→C→A detected). Parent validation (valid parent succeeds, invalid parent fails).","acceptance_criteria":"All unit tests pass. ID uniqueness verified over 1000 generations. All valid status transitions tested. All invalid transitions tested. Cycle detection works for depth 2 and 3. \u003e90% coverage.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:13Z","created_by":"Chris Trower","updated_at":"2026-02-15T04:49:36Z","closed_at":"2026-02-15T04:49:36Z","close_reason":"90.5% coverage achieved with existing unit and integration tests","labels":["bead-mgmt","phase-1","testing"],"dependencies":[{"issue_id":"railyard-5ll.4.1","depends_on_id":"railyard-5ll.4","type":"parent-child","created_at":"2026-02-14T20:02:13Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-5ll.4.2","title":"Integration tests for dependencies and ready detection","description":"internal/bead/deps_test.go (integration, requires Dolt). Test: create chain A blocks B blocks C — ReadyBeads returns only A. Complete A — ReadyBeads returns B. Complete B — ReadyBeads returns C. Cross-track deps: backend bead blocks frontend bead, same railyard. Edge case: bead with cancelled blocker is ready. Edge case: bead with mix of done and pending blockers is not ready.","acceptance_criteria":"All integration tests pass. Ready detection correct for chains, cross-track, cancelled blockers, partial completion. \u003e90% coverage for deps.go.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:14Z","created_by":"Chris Trower","updated_at":"2026-02-15T04:49:36Z","closed_at":"2026-02-15T04:49:36Z","close_reason":"90.5% coverage achieved with existing unit and integration tests","labels":["bead-mgmt","phase-1","testing"],"dependencies":[{"issue_id":"railyard-5ll.4.2","depends_on_id":"railyard-5ll.4","type":"parent-child","created_at":"2026-02-14T20:02:14Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-5wk","title":"Wire action handlers into processInbox switch statement","description":"Update processInbox() in daemon.go to route standardized subjects to the new handler functions from actions.go. Add cases for: restart-engine, retry-merge, requeue-car, nudge-engine, unblock-car. Also improve engine-stalled handler to write a CarProgress note with stall details (currently just logs and acks).\n\nUpdate processInbox signature to accept (ctx, db, cfg, configPath, repoDir, out) so handlers have access to config and repoDir for RestartEngine and Switch operations.\n\nNew switch cases in processInbox:\n- 'restart-engine' -\u003e handleRestartEngine(ctx, db, cfg, configPath, msg, out); ackMsg\n- 'retry-merge' -\u003e handleRetryMerge(db, cfg, repoDir, msg, out); ackMsg\n- 'requeue-car' -\u003e handleRequeueCar(db, msg, out); ackMsg\n- 'nudge-engine' -\u003e handleNudgeEngine(db, msg, out); ackMsg\n- 'unblock-car' -\u003e handleUnblockCar(db, msg, out); ackMsg\n\nImproved engine-stalled: write CarProgress note on the car, if 3+ stalls on same car escalate to Claude via EscalateToClaude().\n\nFiles: internal/yardmaster/daemon.go (MODIFY)\n\nTest requirements:\n- All existing daemon tests pass with updated signatures\n- go test ./internal/yardmaster/ -v passes\n- go build ./cmd/ry/ compiles","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-17T02:07:52Z","created_by":"Chris Trower","updated_at":"2026-02-17T02:18:33Z","closed_at":"2026-02-17T02:18:33Z","close_reason":"Wired 5 action handlers into processInbox switch, improved engine-stalled to write progress notes, added epic-closed to ack-only subjects","dependencies":[{"issue_id":"railyard-5wk","depends_on_id":"railyard-blu","type":"blocks","created_at":"2026-02-16T20:09:17Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-5wk","depends_on_id":"railyard-vxg","type":"blocks","created_at":"2026-02-16T20:09:17Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-6f1","title":"Exclude railyard.yaml and orchestration files from engine agent visibility","description":"## Problem\n\nWhen an engine's Claude Code session searches/reads the project repo, it sees `railyard.yaml` which contains Dolt database connection config (host, port, database name). This confused the agent during a todo app test — it saw the database name and incorporated it into its work instead of building the requested in-memory store.\n\nEngines work in git worktrees (`engines/\u003cengineID\u003e/`) which are checkouts of the same repo, so all repo files including `railyard.yaml` are visible to the Claude Code subprocess.\n\nOther Railyard artifacts that could cause similar confusion:\n- `railyard.yaml` — Dolt DB config, track definitions, stall thresholds\n- `engines/` directory — other engine worktrees (shouldn't be visible, already gitignored?)\n- `.beads/` directory — issue tracking data\n\n## Approach Options\n\n### Option A: .claudeignore in worktree (preferred)\nClaude Code respects `.claudeignore` files (same format as `.gitignore`). Before spawning the agent, the engine could write a `.claudeignore` into the worktree that excludes Railyard files:\n```\nrailyard.yaml\n.beads/\nengines/\n```\nThis is the cleanest solution — the agent never sees the files at all.\n\nImplementation: In `EnsureWorktree()` or `SpawnAgent()` in `internal/engine/git.go` or `internal/engine/subprocess.go`, write the `.claudeignore` file before launching claude.\n\n### Option B: System prompt instruction\nAdd a line to `writeInstructions()` in `internal/engine/context.go` telling the agent to ignore `railyard.yaml`. Less robust — agents can still stumble on it during file searches.\n\n### Option C: Both\nWrite `.claudeignore` AND mention it in the prompt for belt-and-suspenders safety.\n\n## Acceptance Criteria\n- [ ] Engine agents cannot see or search `railyard.yaml` during their work\n- [ ] `.claudeignore` is written to the worktree before the Claude Code subprocess starts\n- [ ] Excluded files: `railyard.yaml`, `.beads/`, `engines/`\n- [ ] The `.claudeignore` is not committed to git (it lives only in the worktree)\n- [ ] Existing tests still pass\n- [ ] Verify by checking that `buildCommand()` in subprocess.go runs after the ignore file is in place","status":"closed","priority":2,"issue_type":"bug","owner":"chris.trower@outlook.com","created_at":"2026-02-16T21:49:16Z","created_by":"Chris Trower","updated_at":"2026-02-16T22:14:18Z","closed_at":"2026-02-16T22:14:18Z","close_reason":"Implemented .claudeignore in worktrees, fixed stall re-claim loop, added engine restart to yardmaster/dispatch prompts"}
{"id":"railyard-6jl","title":"Dashboard engine detail view","description":"Build the engine detail drill-down page for the dashboard.\n\n## What to build\n\n### Engine detail page (GET /engines/{id})\n- Header: engine ID, status badge (color-coded), track\n- Metadata: role, session ID, started at, last activity (absolute + relative), uptime\n- Current car section: link to car detail if engine has a current car, show car title/status/priority\n- If no current car: show \"Idle — no car claimed\"\n- Recent activity: query CarProgress entries where engine_id matches, show chronological list of work done\n\n### Query functions\n- GetEngineDetail(db, id) — engine record with computed uptime\n- GetEngineActivity(db, engineID) — recent progress notes from this engine across all cars\n\n### Template\n- templates/engine_detail.html — extends base layout\n\n## Acceptance criteria\n- [ ] GET /engines/{id} shows full engine detail with all fields\n- [ ] Current car section links to car detail page\n- [ ] Recent activity shows progress notes from this engine\n- [ ] Status is color-coded: green=working, gray=idle, yellow=stalled, red=dead\n- [ ] Navigation: dashboard engines table → engine detail → back\n- [ ] Tests: handler returns 200 with expected content, 404 for unknown engine ID, activity query returns correct entries","status":"closed","priority":2,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-17T02:07:53Z","created_by":"Chris Trower","updated_at":"2026-02-17T13:42:32Z","closed_at":"2026-02-17T13:42:32Z","close_reason":"Closed","dependencies":[{"issue_id":"railyard-6jl","depends_on_id":"railyard-55e","type":"blocks","created_at":"2026-02-16T20:10:35Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-6qm","title":"Harden quickstart \u0026 install scripts for isolated WSL","description":"The quickstart.sh, quickstart-test.sh, and install.sh scripts have several issues that prevent clean operation on a fresh isolated WSL environment. This epic covers indentation fixes, port conflict detection, readiness checks, cleanup traps, prerequisite validation, and PATH setup.","status":"closed","priority":1,"issue_type":"epic","owner":"chris.trower@outlook.com","created_at":"2026-02-15T20:11:06Z","created_by":"Chris Trower","updated_at":"2026-02-16T20:01:33Z","closed_at":"2026-02-16T20:01:33Z","close_reason":"Closed"}
{"id":"railyard-6qm.1","title":"Fix install.sh indentation","description":"install.sh has severely broken indentation starting around line 22. The control flow works but indentation escalates to 100+ chars deep. Needs a complete reformatting pass to make it readable and maintainable.","status":"closed","priority":1,"issue_type":"bug","owner":"chris.trower@outlook.com","created_at":"2026-02-15T20:11:35Z","created_by":"Chris Trower","updated_at":"2026-02-15T21:33:01Z","closed_at":"2026-02-15T21:33:01Z","close_reason":"Not applicable - install.sh is for cocoindex setup in this repo, not part of the railyard project","dependencies":[{"issue_id":"railyard-6qm.1","depends_on_id":"railyard-6qm","type":"parent-child","created_at":"2026-02-15T14:11:34Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-6qm.2","title":"Add port conflict detection to quickstart.sh","description":"quickstart.sh uses port 3306 (default MySQL port). If MySQL/MariaDB is installed, the ss check at line 107 silently assumes Dolt is running. Should warn or use an alternate port like quickstart-test.sh does with 3307.","status":"closed","priority":1,"issue_type":"bug","owner":"chris.trower@outlook.com","created_at":"2026-02-15T20:11:39Z","created_by":"Chris Trower","updated_at":"2026-02-16T19:33:51Z","closed_at":"2026-02-16T19:33:51Z","close_reason":"Closed","dependencies":[{"issue_id":"railyard-6qm.2","depends_on_id":"railyard-6qm","type":"parent-child","created_at":"2026-02-15T14:11:38Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-6qm.3","title":"Add Dolt readiness check beyond port check","description":"Both quickstart scripts check ss -tlnp for port open, but port-open doesn't mean Dolt is ready for MySQL queries. Replace with actual connection test (e.g. mysql -h 127.0.0.1 -P PORT -u root -e 'SELECT 1') to avoid confusing GORM errors on ry db init.","status":"closed","priority":2,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T20:11:43Z","created_by":"Chris Trower","updated_at":"2026-02-16T20:00:53Z","closed_at":"2026-02-16T20:00:53Z","close_reason":"Closed","dependencies":[{"issue_id":"railyard-6qm.3","depends_on_id":"railyard-6qm","type":"parent-child","created_at":"2026-02-15T14:11:42Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-6qm.4","title":"Add trap/cleanup on quickstart script failure","description":"If quickstart.sh or quickstart-test.sh fails midway (e.g. go build fails), Dolt is left running in the background as an orphaned process. Add trap on ERR/EXIT to clean up Dolt and any other started processes.","status":"closed","priority":2,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T20:11:47Z","created_by":"Chris Trower","updated_at":"2026-02-16T20:00:53Z","closed_at":"2026-02-16T20:00:53Z","close_reason":"Closed","dependencies":[{"issue_id":"railyard-6qm.4","depends_on_id":"railyard-6qm","type":"parent-child","created_at":"2026-02-15T14:11:46Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-6qm.5","title":"Add prerequisite fallbacks and checks to quickstart scripts","description":"quickstart.sh uses ss without fallback (install.sh properly falls back to lsof/netstat). Also uses curl without checking if installed. Add the same fallback chain and verify curl/basic dependencies are present before proceeding.","status":"closed","priority":2,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T20:11:50Z","created_by":"Chris Trower","updated_at":"2026-02-16T20:00:53Z","closed_at":"2026-02-16T20:00:53Z","close_reason":"Closed","dependencies":[{"issue_id":"railyard-6qm.5","depends_on_id":"railyard-6qm","type":"parent-child","created_at":"2026-02-15T14:11:50Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-6qm.6","title":"Add ~/.local/bin PATH setup to quickstart scripts","description":"Both quickstart.sh and quickstart-test.sh symlink ry to ~/.local/bin/ry but don't add ~/.local/bin to PATH. Fresh Ubuntu WSL instances don't have this in PATH unless .profile was sourced after the dir was created. Scripts should verify and add to current session + shell rc file.","status":"closed","priority":1,"issue_type":"bug","owner":"chris.trower@outlook.com","created_at":"2026-02-15T20:11:55Z","created_by":"Chris Trower","updated_at":"2026-02-16T19:33:51Z","closed_at":"2026-02-16T19:33:51Z","close_reason":"Closed","dependencies":[{"issue_id":"railyard-6qm.6","depends_on_id":"railyard-6qm","type":"parent-child","created_at":"2026-02-15T14:11:54Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-8qi","title":"Yardmaster exits immediately on start due to stale drain broadcast","description":"When ry stop sends a drain broadcast and then ry start launches a new yardmaster, the stale drain message is still in the messages table. The new yardmaster picks it up on its first inbox poll and immediately shuts down. Fix: have processInbox skip drain messages created before the yardmaster's own StartedAt.","status":"closed","priority":1,"issue_type":"bug","owner":"chris.trower@outlook.com","created_at":"2026-02-17T16:20:11Z","created_by":"Chris Trower","updated_at":"2026-02-17T16:22:51Z","closed_at":"2026-02-17T16:22:51Z","close_reason":"Fixed in d8f048f — processInbox now skips drain messages created before yardmaster startup"}
{"id":"railyard-9b6","title":"Dashboard SSE endpoint for real-time escalation alerts","description":"Add Server-Sent Events (SSE) endpoint so the dashboard can push escalation alerts to the browser without polling.\n\n## What to build\n\n### SSE endpoint (GET /api/events)\n- internal/dashboard/sse.go: SSE handler\n- Keeps connection open, sends events when new human escalations arrive\n- Poll the DB every 2-3s for new unacked messages to \"human\" agent since last check\n- Event format: event: escalation\\ndata: {json with message id, subject, from, body preview}\\n\\n\n- Also send periodic heartbeat events to keep connection alive: event: heartbeat\\ndata: {timestamp}\\n\\n\n- Handle client disconnect gracefully (context cancellation)\n\n### Browser integration\n- Add EventSource JavaScript (minimal, ~10 lines) in base template\n- On \"escalation\" event: show/update the alert banner at top of page with message count and latest subject\n- Banner should be visually distinct (e.g., amber/red background) and link to /messages\n- On \"heartbeat\": optionally update a \"last updated\" indicator\n\n### Fallback\n- If SSE connection drops, HTMX polling on the alerts partial still works as fallback\n- The alert banner section already has hx-get polling from the main page task — SSE just makes it faster\n\n## Acceptance criteria\n- [ ] GET /api/events returns text/event-stream content type\n- [ ] New human escalation messages trigger an SSE event within 3s\n- [ ] Browser shows alert banner when escalation event received\n- [ ] Alert banner shows count and latest escalation subject\n- [ ] SSE connection handles client disconnect without goroutine leak\n- [ ] Heartbeat events sent every 15s to keep connection alive\n- [ ] Falls back gracefully to HTMX polling if SSE disconnects\n- [ ] Tests: SSE handler sends correct event format, escalation detection query works, connection cleanup on context cancel","status":"closed","priority":2,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-17T02:08:23Z","created_by":"Chris Trower","updated_at":"2026-02-17T13:42:32Z","closed_at":"2026-02-17T13:42:32Z","close_reason":"Closed","dependencies":[{"issue_id":"railyard-9b6","depends_on_id":"railyard-55e","type":"blocks","created_at":"2026-02-16T20:10:36Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-9zs","title":"Add require_pr config option for draft PR creation instead of direct merge","description":"Currently the yardmaster directly merges completed car branches to main via gitMerge(). Some teams require PRs for code review before merging.\n\nAdd a top-level config option 'require_pr: true' (default false). When enabled, the Switch() flow changes:\n\n1. Tests still run on the branch (no change)\n2. If tests pass: instead of gitMerge(), push the branch to origin and run 'gh pr create --draft' with a rich description\n3. Set car status to 'pr_open' instead of 'merged'\n4. The yardmaster should NOT push main or trigger reindex — that happens when the PR is actually merged\n\n## PR Description Template\n\nThe gh pr create body must be human-readable and give reviewers everything they need at a glance. Pull from the car's DB record and git diff:\n\n**Title:** Car title (e.g. 'Add JWT middleware for protected routes')\n\n**Body sections:**\n- **Summary** — Car description (the what and why)\n- **Acceptance Criteria** — From car.Acceptance field (what the reviewer should verify)\n- **Design Notes** — From car.DesignNotes if present (architectural decisions, approach taken)\n- **What Changed** — git diff --stat between main and the branch (files added/modified/deleted with line counts)\n- **Progress Notes** — From car_progress entries (engine's notes on what it did each cycle, ordered chronologically). This gives the reviewer a narrative of how the work was done.\n- **Metadata** footer — Car ID, track, priority, engine that did the work, branch name\n\nExample PR body:\n```\n## Summary\nAdd JWT middleware that validates tokens on protected routes. Extracts user claims and attaches them to the request context.\n\n## Acceptance Criteria\n- Middleware rejects expired tokens with 401\n- Middleware rejects malformed tokens with 401\n- Valid tokens populate req.Context with user ID and role\n- Unit tests cover happy path, expired, malformed, and missing token\n\n## Design Notes\nUses the existing auth package for token validation. Middleware is a standard net/http wrapper that can be composed with other middleware.\n\n## What Changed\n cmd/api/middleware.go    | 45 ++++++++++++\n cmd/api/middleware_test.go | 89 +++++++++++++++++++++\n cmd/api/routes.go        |  8 ++-\n 3 files changed, 141 insertions(+), 1 deletion(-)\n\n## Progress\n- [eng-a1b2] Created middleware with token extraction and context injection\n- [eng-a1b2] Added test coverage for all token states (valid, expired, malformed, missing)\n- [eng-a1b2] Wired middleware into protected route group in routes.go\n\n---\nCar: car-abc123 | Track: backend | Priority: P1 | Engine: eng-a1b2 | Branch: ry/alice/backend/car-abc123\n```\n\n## Files to change\n- internal/config/config.go — add RequirePR bool to Config\n- internal/yardmaster/switch.go — branch on RequirePR: build PR body from car+progress+diff, create draft PR via gh CLI instead of gitMerge, return new SwitchResult fields (PRUrl, PRCreated)\n- internal/yardmaster/daemon.go — pass RequirePR to Switch, skip push/reindex when PR created instead of merged\n- SwitchOpts gets a RequirePR field\n- SwitchResult gets PRUrl string and PRCreated bool fields\n\nThe 'pr_open' status means a PR exists but hasn't been merged yet. A future enhancement could poll for PR merge status, but that's out of scope for this bead.","status":"closed","priority":2,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-17T16:59:56Z","created_by":"Chris Trower","updated_at":"2026-02-17T17:56:13Z","closed_at":"2026-02-17T17:56:13Z","close_reason":"Implemented require_pr config option with draft PR creation, rich PR body builder, and tests"}
{"id":"railyard-a7w","title":"Add engine-to-yardmaster bug escalation flow","description":"When an engine files a bug car (per railyard-s6v), the yardmaster needs to know about it and triage it. Currently the yardmaster prompt (internal/yardmaster/prompt.go) has no awareness of engine-filed bugs.\n\nThis issue adds the yardmaster-side handling:\n\n1. **Bug triage in monitoring loop**: Yardmaster should check for newly created bug cars (status=open, type=bug) during its monitoring cycle and decide: assign to an engine immediately, add dependencies to block other work, or escalate to human.\n\n2. **Priority assessment**: Yardmaster should have rules for bug priority — a security issue or broken test should be P0/P1 and may need to pause other work. A minor inconsistency can be P3.\n\n3. **Cross-car impact**: If a bug affects a car that's currently in_progress, yardmaster should message that engine to warn them.\n\nAcceptance criteria:\n- [ ] Add 'Bug Triage' section to yardmaster prompt in prompt.go\n- [ ] Include rules: check for new bug cars, assess priority, decide on assignment vs. escalation\n- [ ] Add instruction to message engines if a bug affects their in-progress car\n- [ ] Add ry car list --type bug to the monitoring loop commands\n- [ ] Existing tests still pass","status":"closed","priority":2,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-16T21:05:20Z","created_by":"Chris Trower","updated_at":"2026-02-17T03:38:57Z","closed_at":"2026-02-17T03:38:57Z","close_reason":"Bug triage section added to yardmaster prompt with priority rules, cross-car impact messaging, and monitoring loop integration","dependencies":[{"issue_id":"railyard-a7w","depends_on_id":"railyard-s6v","type":"blocks","created_at":"2026-02-16T15:05:26Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-acy","title":"ClaimCar serialization failure needs retry loop","description":"## Bug\nWhen two engines on the same track attempt to claim a car simultaneously, one gets a Dolt serialization failure:\n\n    Claim error: Error 1213 (40001): serialization failure: this transaction conflicts with a committed transaction from another client, try restarting transaction\n\nThe error is not retried — it propagates up and the engine fails to claim any car that cycle.\n\n## Root Cause\ninternal/engine/claim.go ClaimCar() uses SELECT ... FOR UPDATE SKIP LOCKED inside a transaction, but Dolt does not fully support row-level SKIP LOCKED (noted in the code comment on line 17). Dolt falls back to transaction serialization, which means concurrent claims on the same car conflict. The losing transaction gets Error 1213, which is a retryable error — Dolt even says \"try restarting transaction\" in the message — but the code does not retry.\n\n## Fix\nWrap the db.Transaction() call in ClaimCar() in a retry loop (2-3 attempts) with a short random backoff between retries. On Error 1213 (or any MySQL deadlock/serialization error), retry the full transaction. On other errors, return immediately.\n\nThis is a standard pattern for databases with optimistic concurrency control.\n\n## Acceptance criteria\n- [ ] ClaimCar retries on serialization failure (Error 1213) up to 3 times\n- [ ] Backoff between retries is short and randomized (e.g., 50-200ms jitter) to avoid thundering herd\n- [ ] Non-retryable errors still return immediately\n- [ ] After max retries exhausted, return the last error\n- [ ] Add a test that verifies the retry logic (can mock/simulate the error)\n- [ ] Log a warning on retry so it's visible in engine output\n- [ ] Existing ClaimCar tests still pass","status":"closed","priority":1,"issue_type":"bug","owner":"chris.trower@outlook.com","created_at":"2026-02-17T02:11:51Z","created_by":"Chris Trower","updated_at":"2026-02-17T02:15:42Z","closed_at":"2026-02-17T02:15:42Z","close_reason":"Added retry loop with jittered backoff (50-200ms) to ClaimCar for Dolt serialization failures (Error 1213). Retries up to 3 times, logs warnings on retry, returns immediately on non-retryable errors."}
{"id":"railyard-blu","title":"Implement yardmaster action handlers for dispatch messages","description":"Create internal/yardmaster/actions.go with handler functions for standardized dispatch-to-yardmaster action subjects. Each handler validates msg.CarID, performs the action, writes a CarProgress note, and logs to out.\n\nHandlers:\n- handleRestartEngine(ctx, db, cfg, configPath, msg, out) — find engine assigned to msg.CarID, call orchestration.RestartEngine(), reassign car via ReassignCar()\n- handleRetryMerge(db, cfg, repoDir, msg, out) — set car status back to 'done' so handleCompletedCars picks it up on next daemon cycle, write progress note\n- handleRequeueCar(db, msg, out) — set car status to 'open', clear assignee, write progress note (like ReassignCar but without killing engine)\n- handleNudgeEngine(db, msg, out) — look up engine assigned to msg.CarID, forward msg.Body as 'guidance' message to that engine via messaging.Send()\n- handleUnblockCar(db, msg, out) — set car status from 'blocked' to 'open', write progress note\n\nReuse existing functions:\n- orchestration.RestartEngine() from internal/orchestration/scale.go:262\n- yardmaster.ReassignCar() from internal/yardmaster/health.go:42\n- car.Update() from internal/car/car.go:171 (has status transition validation)\n- car.Get() from internal/car/car.go:132\n- messaging.Send() from internal/messaging/messaging.go:20\n- models.CarProgress pattern from health.go:72-79\n\nFiles: internal/yardmaster/actions.go (NEW)\n\nTest requirements:\n- TestHandleRestartEngine_NoCarID — logs warning, no action\n- TestHandleRetryMerge_SetsStatusDone — car blocked-\u003edone\n- TestHandleRequeueCar_SetsStatusOpen — car-\u003eopen, assignee cleared\n- TestHandleNudgeEngine_ForwardsGuidance — guidance message sent to correct engine\n- TestHandleUnblockCar_SetsStatusOpen — car blocked-\u003eopen\n- TestHandleRequeueCar_WritesProgressNote — progress note created\n- go build and go vet clean","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-17T02:07:41Z","created_by":"Chris Trower","updated_at":"2026-02-17T02:17:44Z","closed_at":"2026-02-17T02:17:44Z","close_reason":"Created actions.go with 5 handler functions: handleRestartEngine, handleRetryMerge, handleRequeueCar, handleNudgeEngine, handleUnblockCar plus writeProgressNote helper"}
{"id":"railyard-bx6","title":"Dashboard messages and escalation view","description":"Build the messages list page with escalation highlighting for the dashboard.\n\n## What to build\n\n### Messages page (GET /messages)\n- Query params: ?agent=, ?priority=, ?unacked= for filtering\n- Default view: show all messages, newest first\n- Table columns: timestamp, from → to, subject, priority badge (urgent=red, normal=default, low=gray), acknowledged (checkmark or dash), car link (if car_id set)\n- Escalation section at top: separate highlighted area for messages where to_agent=\"human\" and acknowledged=false — these are the ones the user needs to see\n- Filter controls: by agent, by priority, show unacked only toggle\n- Message body preview: truncated in list, expandable or shown on click/hover\n\n### Query functions\n- ListMessages(db, filters) — messages with filtering and ordering\n- PendingEscalations(db) — unacked messages to \"human\" agent\n- Count functions for badge numbers\n\n### Template\n- templates/messages.html — messages list page extending base layout\n\n## Acceptance criteria\n- [ ] GET /messages returns full message list, newest first\n- [ ] Escalation section at top shows unacked human messages prominently\n- [ ] GET /messages?priority=urgent filters correctly\n- [ ] GET /messages?unacked=true shows only unacknowledged messages\n- [ ] Priority is color-coded: urgent=red, normal=default, low=gray\n- [ ] Car links work when car_id is set on message\n- [ ] Message body is visible (truncated in list, expandable)\n- [ ] Navigation: dashboard → messages → back, dashboard alert banner → messages\n- [ ] Tests: query functions filter correctly, handler returns 200, escalation section renders when unacked human messages exist and hides when none","status":"closed","priority":2,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-17T02:08:06Z","created_by":"Chris Trower","updated_at":"2026-02-17T13:42:32Z","closed_at":"2026-02-17T13:42:32Z","close_reason":"Closed","dependencies":[{"issue_id":"railyard-bx6","depends_on_id":"railyard-55e","type":"blocks","created_at":"2026-02-16T20:10:35Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-c6d","title":"Add draft status for cars to prevent premature engine claiming during planning","description":"## Problem\n\nWhen Dispatch decomposes a request into multiple cars, it creates them one at a time via `ry car create`. Each car is immediately created with `status=open`. If a car has no dependencies (e.g., a foundation task), an engine can claim it instantly — before Dispatch has finished creating the rest of the plan, setting up dependencies, or adjusting priorities.\n\nThis causes problems:\n- Engine starts work before the full dependency chain is in place\n- If Dispatch adds a dependency AFTER an engine already claimed the car, the dependency is meaningless\n- Engine may produce code that conflicts with the plan Dispatch hasn't finished creating\n- Race condition: engine claims car → Dispatch adds dep → dep is ignored because car is already claimed\n\n## Solution: Add a `draft` status\n\nCars should be created in `draft` status instead of `open`. Dispatch creates all cars, sets all dependencies, then explicitly publishes them to `open` when the plan is complete.\n\n### Flow\n1. Dispatch creates cars → all start as `status=draft`\n2. Dispatch sets dependencies between cars\n3. Dispatch reviews the plan with the user (if interactive)\n4. Dispatch publishes: `ry car publish \u003cepic-id\u003e` (or `ry car update \u003cid\u003e --status open`)\n5. NOW engines can claim them\n\n### Changes Required\n\n#### 1. Car creation (`internal/car/car.go`)\n- Change default status from `open` to `draft` in `Create()`\n- OR add a `--draft` flag that Dispatch uses (keep backward compat for manual `ry car create`)\n\n#### 2. ClaimCar and ReadyCars queries\n- Already filter on `status=open` — draft cars are automatically excluded, no changes needed\n\n#### 3. Add `ry car publish` command (`cmd/ry/car.go`)\n- Transitions a car (or all children of an epic) from `draft` to `open`\n- `ry car publish \u003ccar-id\u003e` — publish single car\n- `ry car publish \u003cepic-id\u003e --recursive` — publish epic and all draft children\n- Only transitions `draft` → `open`, not other statuses\n\n#### 4. Dispatch prompt (`internal/dispatch/prompt.go`)\n- Update workflow to create cars as draft\n- Add publish step after all cars and deps are set up\n- Show `ry car publish` in available commands\n\n#### 5. Car model (`internal/models/car.go`)\n- Document `draft` as a valid status in the model comments\n\n## Acceptance Criteria\n- [ ] Cars created by Dispatch start in `draft` status\n- [ ] `ry car ready` does not show draft cars\n- [ ] Engines cannot claim draft cars (ClaimCar already filters on open)\n- [ ] `ry car publish \u003cid\u003e` transitions draft → open\n- [ ] `ry car publish \u003cepic-id\u003e --recursive` publishes epic and children\n- [ ] `ry car list --status draft` shows unpublished cars\n- [ ] Manual `ry car create` still defaults to open (or has `--draft` flag)\n- [ ] Dispatch prompt updated with publish workflow\n- [ ] Existing tests still pass","status":"closed","priority":2,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-17T00:58:14Z","created_by":"Chris Trower","updated_at":"2026-02-17T01:13:43Z","closed_at":"2026-02-17T01:13:43Z","close_reason":"Added draft status as default for new cars. Cars now start as draft and must be published (draft→open) before engines can claim them. Added Publish() function with recursive support for epics, ry car publish CLI command, updated Dispatch prompt with draft→publish workflow."}
{"id":"railyard-cek","title":"Yardmaster — Supervisor Agent","description":"Supervisor agent that monitors all engines across all tracks, merges completed branches to main (switch), handles stalls, manages cross-track dependencies within this railyard. Yardmaster is a Claude Code session with a supervisor system prompt. Runs in its own tmux pane. See ARCHITECTURE.md Section Yardmaster (Agent2) and IMPLEMENTATION_PLAN.md Epic 5.","design":"See ARCHITECTURE.md Section Yardmaster (Agent2) — responsibilities: monitor health, switch branches, handle stalls, manage deps, trigger reindex","acceptance_criteria":"Yardmaster detects completed branch, runs tests, merges to main, unblocks downstream beads. Detects stalled engine, reassigns bead. Creates reindex_jobs rows after merge. Single instance per railyard enforced. \u003e90% test coverage for internal/yardmaster/.","status":"closed","priority":1,"issue_type":"epic","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:01:50Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:48:07Z","closed_at":"2026-02-15T17:48:07Z","close_reason":"All children complete. 91.7% test coverage for internal/yardmaster/.","labels":["phase-1","yardmaster"],"dependencies":[{"issue_id":"railyard-cek","depends_on_id":"railyard-i3n","type":"blocks","created_at":"2026-02-14T20:03:06Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cek.1","title":"Yardmaster Agent Framework","description":"Yardmaster package scaffold and system prompt. Launched as Claude Code session with supervisor prompt. Has access to ry CLI commands. Runs in own tmux pane. See ARCHITECTURE.md Yardmaster section.","acceptance_criteria":"Yardmaster starts as Claude Code session. System prompt includes all responsibilities and available commands. Subprocess managed with restart on crash. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:37Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:32:38Z","closed_at":"2026-02-15T17:32:38Z","close_reason":"Closed","labels":["framework","phase-1","yardmaster"],"dependencies":[{"issue_id":"railyard-cek.1","depends_on_id":"railyard-cek","type":"parent-child","created_at":"2026-02-14T20:02:37Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-cek.1","depends_on_id":"railyard-i3n.2","type":"blocks","created_at":"2026-02-14T20:03:21Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cek.1.1","title":"Implement yardmaster package scaffold","description":"Create internal/yardmaster/yardmaster.go. Start(db *gorm.DB, config *config.Config) error — loads system prompt, launches Claude Code with prompt via claude --prompt or AGENTS.md injection. Manages subprocess lifecycle: restart on unexpected exit, clean shutdown on signal. Registers in engines table with role=yardmaster.","acceptance_criteria":"Yardmaster starts Claude Code with prompt. Restarts on crash. Clean shutdown works. Registered in engines table. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:38Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:32:38Z","closed_at":"2026-02-15T17:32:38Z","close_reason":"Closed","labels":["framework","phase-1","yardmaster"],"dependencies":[{"issue_id":"railyard-cek.1.1","depends_on_id":"railyard-cek.1","type":"parent-child","created_at":"2026-02-14T20:02:37Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cek.1.2","title":"Write yardmaster system prompt","description":"Create yardmaster system prompt (internal/yardmaster/prompt.go or yardmaster_prompt.md). Content: role definition (supervisor of all engines across all tracks for this railyard), responsibilities (monitor engine health, merge completed branches, handle stalls, manage cross-track deps, create reindex jobs), available ry commands (ry engine list, ry bead list, ry bead ready, ry bead reassign, ry switch, ry message send, ry inbox, ry status), poll interval (30s default), escalation rules (when to message human: repeated stalls, test failures after 3 retries, merge conflicts).","acceptance_criteria":"Prompt is comprehensive and unambiguous. All ry commands listed with usage. Responsibilities clearly defined. Escalation rules explicit. \u003e90% test coverage for prompt rendering.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:39Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:32:38Z","closed_at":"2026-02-15T17:32:38Z","close_reason":"Closed","labels":["framework","phase-1","yardmaster"],"dependencies":[{"issue_id":"railyard-cek.1.2","depends_on_id":"railyard-cek.1","type":"parent-child","created_at":"2026-02-14T20:02:38Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cek.2","title":"Engine Health Monitoring \u0026 Stall Handling","description":"Yardmaster queries engines table for stale heartbeats and stalled engines. Reads context and decides intervention: reassign bead, provide guidance, or escalate to human.","acceptance_criteria":"Stale heartbeat detection works with configurable threshold. Stalled engines identified. Bead reassignment releases and re-queues. Human escalation via message. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:39Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:35:45Z","closed_at":"2026-02-15T17:35:45Z","close_reason":"Closed","labels":["health","phase-1","yardmaster"],"dependencies":[{"issue_id":"railyard-cek.2","depends_on_id":"railyard-cek","type":"parent-child","created_at":"2026-02-14T20:02:39Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-cek.2","depends_on_id":"railyard-cek.1","type":"blocks","created_at":"2026-02-14T20:03:22Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cek.2.1","title":"Implement heartbeat staleness detection","description":"Create internal/yardmaster/health.go. CheckEngineHealth(db *gorm.DB, threshold time.Duration) ([]models.Engine, error) — returns engines WHERE last_activity \u003c NOW() - threshold AND status NOT IN ('dead'). StaleEngines(db) — convenience wrapper with 60s default threshold.","acceptance_criteria":"Stale engines detected with configurable threshold. Dead engines excluded. Returns correct engines list. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:40Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:35:45Z","closed_at":"2026-02-15T17:35:45Z","close_reason":"Closed","labels":["health","phase-1","yardmaster"],"dependencies":[{"issue_id":"railyard-cek.2.1","depends_on_id":"railyard-cek.2","type":"parent-child","created_at":"2026-02-14T20:02:40Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cek.2.2","title":"Implement stalled engine handling and bead reassignment","description":"ReassignBead(db *gorm.DB, beadID, fromEngineID, reason string) error — in transaction: update bead status=open, assignee=nil, claimed_at=nil. Write progress note 'Reassigned from {engineID}: {reason}'. Update old engine status=dead. Send broadcast message about reassignment. ry bead reassign CLI command wraps this function.","acceptance_criteria":"Bead unclaimed and re-queued. Progress note records reason. Old engine marked dead. Broadcast sent. CLI command works. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:41Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:35:45Z","closed_at":"2026-02-15T17:35:45Z","close_reason":"Closed","labels":["health","phase-1","yardmaster"],"dependencies":[{"issue_id":"railyard-cek.2.2","depends_on_id":"railyard-cek.2","type":"parent-child","created_at":"2026-02-14T20:02:40Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cek.3","title":"Branch Merging (Switch)","description":"When engine completes bead, yardmaster pulls branch, runs track test suite, merges to main if tests pass. 'Switch' in Railyard terminology. Handles test failures and cross-track dependency unblocking.","acceptance_criteria":"Switch flow: pull, test, merge. Test failures send bead back. Cross-track deps unblocked after merge. ry switch CLI works. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:42Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:47:43Z","closed_at":"2026-02-15T17:47:43Z","close_reason":"Closed","labels":["phase-1","switch","yardmaster"],"dependencies":[{"issue_id":"railyard-cek.3","depends_on_id":"railyard-cek","type":"parent-child","created_at":"2026-02-14T20:02:41Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-cek.3","depends_on_id":"railyard-cek.2","type":"blocks","created_at":"2026-02-14T20:03:22Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cek.3.1","title":"Implement branch merge flow","description":"Create internal/yardmaster/switch.go. Switch(db *gorm.DB, beadID string, config *config.Config) error — flow: (1) get bead and track info, (2) git fetch origin {bead.Branch}, (3) git checkout {bead.Branch}, (4) run track test command (track.Conventions['test_command'] or default: go test ./... for Go, npm test for TS), (5) if tests pass: git checkout main \u0026\u0026 git merge {bead.Branch} --no-ff, (6) if tests fail: set bead status=blocked, send message to assignee engine with test output. (7) git checkout main after either outcome.","acceptance_criteria":"Merge succeeds when tests pass. Bead blocked when tests fail. Test output sent to engine. Main branch updated. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:42Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:47:43Z","closed_at":"2026-02-15T17:47:43Z","close_reason":"Closed","labels":["phase-1","switch","yardmaster"],"dependencies":[{"issue_id":"railyard-cek.3.1","depends_on_id":"railyard-cek.3","type":"parent-child","created_at":"2026-02-14T20:02:42Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cek.3.2","title":"Implement ry switch CLI command","description":"ry switch \u003cbead-id\u003e — runs the Switch flow manually. Prints test results and merge status. ry switch --dry-run \u003cbead-id\u003e — runs tests on the branch without actually merging (useful for pre-validation).","acceptance_criteria":"ry switch executes full flow. --dry-run runs tests only. Output shows test results and merge status. Invalid bead ID returns error. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:43Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:47:43Z","closed_at":"2026-02-15T17:47:43Z","close_reason":"Closed","labels":["phase-1","switch","yardmaster"],"dependencies":[{"issue_id":"railyard-cek.3.2","depends_on_id":"railyard-cek.3","type":"parent-child","created_at":"2026-02-14T20:02:43Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cek.3.3","title":"Implement cross-track dependency unblocking after merge","description":"After successful merge in Switch(), query bead_deps for beads on OTHER tracks that have the completed bead as a blocker: SELECT bd.bead_id FROM bead_deps bd JOIN beads b ON bd.bead_id=b.id WHERE bd.blocked_by=completedBeadID AND b.track != completedBead.track. For each, check if ALL blockers are now done/cancelled. If so, transition from blocked→open. Log each unblocking. Single-railyard only.","acceptance_criteria":"Cross-track blocked beads detected. Only fully unblocked beads transition to open. Partially blocked beads stay blocked. Unblocking logged. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:44Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:47:43Z","closed_at":"2026-02-15T17:47:43Z","close_reason":"Closed","labels":["phase-1","switch","yardmaster"],"dependencies":[{"issue_id":"railyard-cek.3.3","depends_on_id":"railyard-cek.3","type":"parent-child","created_at":"2026-02-14T20:02:43Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cek.4","title":"Post-Merge Operations","description":"After successful merge, create reindex job placeholder for future CocoIndex epic.","acceptance_criteria":"Reindex job row created in reindex_jobs table after merge. Status=pending. Track and commit recorded. \u003e90% test coverage.","status":"closed","priority":1,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:45Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:47:57Z","closed_at":"2026-02-15T17:47:57Z","close_reason":"Reindex job creation integrated into switch flow","labels":["phase-1","post-merge","yardmaster"],"dependencies":[{"issue_id":"railyard-cek.4","depends_on_id":"railyard-cek","type":"parent-child","created_at":"2026-02-14T20:02:44Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-cek.4","depends_on_id":"railyard-cek.3","type":"blocks","created_at":"2026-02-14T20:03:23Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cek.4.1","title":"Implement reindex job creation (placeholder)","description":"After successful Switch(), insert row: INSERT INTO reindex_jobs (track, trigger_commit, status, created_at) VALUES (bead.Track, mergeCommitHash, 'pending', NOW()). No consumer exists yet — CocoIndex epic is deferred. This ensures the interface is ready when CocoIndex is built.","acceptance_criteria":"Reindex job row created with correct track and commit. Status=pending. No errors when no consumer exists. \u003e90% test coverage.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:45Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:47:56Z","closed_at":"2026-02-15T17:47:56Z","close_reason":"CreateReindexJob implemented in switch.go with 100% coverage","labels":["phase-1","post-merge","yardmaster"],"dependencies":[{"issue_id":"railyard-cek.4.1","depends_on_id":"railyard-cek.4","type":"parent-child","created_at":"2026-02-14T20:02:45Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cek.5","title":"Yardmaster CLI \u0026 Test Suite","description":"CLI command to start yardmaster and comprehensive tests. \u003e90% coverage for internal/yardmaster/.","acceptance_criteria":"ry yardmaster starts agent. Single instance enforced. All unit and integration tests pass. \u003e90% coverage.","status":"closed","priority":1,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:46Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:48:01Z","closed_at":"2026-02-15T17:48:01Z","close_reason":"91.7% coverage for internal/yardmaster/","labels":["phase-1","testing","yardmaster"],"dependencies":[{"issue_id":"railyard-cek.5","depends_on_id":"railyard-cek","type":"parent-child","created_at":"2026-02-14T20:02:46Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-cek.5","depends_on_id":"railyard-cek.4","type":"blocks","created_at":"2026-02-14T20:03:24Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cek.5.1","title":"Implement ry yardmaster CLI command","description":"Cobra subcommand: ry yardmaster. Loads config, connects to Dolt, checks no other yardmaster running (query engines WHERE role=yardmaster AND status != dead), starts yardmaster agent. Single instance per railyard enforced — error if one already running.","acceptance_criteria":"ry yardmaster starts agent. Second instance returns error. Clean shutdown updates status. \u003e90% test coverage.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:47Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:48:00Z","closed_at":"2026-02-15T17:48:00Z","close_reason":"ry yardmaster and ry switch CLI commands implemented","labels":["phase-1","testing","yardmaster"],"dependencies":[{"issue_id":"railyard-cek.5.1","depends_on_id":"railyard-cek.5","type":"parent-child","created_at":"2026-02-14T20:02:46Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cek.5.2","title":"Unit tests for yardmaster operations","description":"Test: heartbeat staleness detection (engine with last_activity 30s ago = healthy with 60s threshold, 90s ago = stale). Bead reassignment (status transitions, progress note written, old engine dead). Dependency unblocking (bead with all blockers done transitions, bead with partial blockers stays). Reindex job creation (row created with correct fields).","acceptance_criteria":"All unit tests pass. Edge cases: no stale engines, multiple stale engines, reassignment of unclaimed bead. \u003e90% coverage.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:48Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:48:00Z","closed_at":"2026-02-15T17:48:00Z","close_reason":"Unit tests for all yardmaster operations","labels":["phase-1","testing","yardmaster"],"dependencies":[{"issue_id":"railyard-cek.5.2","depends_on_id":"railyard-cek.5","type":"parent-child","created_at":"2026-02-14T20:02:47Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cek.5.3","title":"Integration tests for merge flow and reassignment","description":"Integration tests with Dolt and git repo. Test: create bead with branch, add commits, run Switch(), verify merge to main. Test: stalled engine detected, bead reassigned, new engine can claim it. Test: completed backend bead unblocks frontend bead (cross-track). Test: test failure in Switch() blocks bead and sends message.","acceptance_criteria":"Full merge flow tested end-to-end. Reassignment tested. Cross-track unblocking tested. Test failure handling tested. \u003e90% coverage.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:48Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:48:01Z","closed_at":"2026-02-15T17:48:01Z","close_reason":"Integration tests for switch, reassignment, health, deps","labels":["phase-1","testing","yardmaster"],"dependencies":[{"issue_id":"railyard-cek.5.3","depends_on_id":"railyard-cek.5","type":"parent-child","created_at":"2026-02-14T20:02:48Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cgz","title":"Rewrite tutorial to be language-agnostic and Dispatch-first","description":"Update docs/tutorial-todo-app.md to: (1) start with a Dispatch session instead of manual car creation, (2) make it language-agnostic with examples for Go, PHP, and Node, (3) show how conventions and test_command vary per language.","status":"closed","priority":2,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-16T20:39:38Z","created_by":"Chris Trower","updated_at":"2026-02-16T20:42:57Z","closed_at":"2026-02-16T20:42:57Z","close_reason":"Closed","dependencies":[{"issue_id":"railyard-cgz","depends_on_id":"railyard-ldf","type":"blocks","created_at":"2026-02-16T14:39:43Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-ciz","title":"ry progress fails with DB JSON parse error on FilesChanged","description":"The ry progress command (cmd/ry/complete.go) creates CarProgress records without setting FilesChanged, leaving it as empty string. Since the column is type:json in the DB, an empty string is invalid JSON and causes a parse error. The fix is to set FilesChanged: \"[]\" (matching the pattern used in engine/outcome.go and yardmaster/health.go). Affects both runProgress (line 97-103) and runComplete (line 52-58) in complete.go.","status":"closed","priority":1,"issue_type":"bug","owner":"chris.trower@outlook.com","created_at":"2026-02-16T22:17:06Z","created_by":"Chris Trower","updated_at":"2026-02-16T22:20:57Z","closed_at":"2026-02-16T22:20:57Z","close_reason":"Fixed both bugs: added FilesChanged:[] to progress notes, added merged status + reconciliation sweep"}
{"id":"railyard-cwz","title":"Track and display token usage per bead","description":"Track token consumption per bead and display it in bead details. Two parts:\n\n1. **Token extraction from stream-json logs**: Parse the agent_logs content (stream-json format) to extract token usage from Claude API responses. The stream-json output includes message objects with usage fields (input_tokens, output_tokens). Either:\n   a. Parse on-the-fly when querying (aggregate from agent_logs), or\n   b. Accumulate token counts in a bead field (token_count_in, token_count_out) updated by the engine daemon after each flush\n\n2. **Display in ry bead show**: Add token usage summary to bead detail output:\n   - Total input tokens\n   - Total output tokens  \n   - Total tokens (combined)\n   - Estimated cost (based on model pricing)\n   Example: 'ry bead show be-xxxxx' shows 'Tokens: 45,230 in / 12,450 out (57,680 total, ~$0.42)'\n\n3. **Display in ry bead list**: Add optional --tokens flag to include token column in list output.\n\n4. **Aggregate stats**: 'ry stats' should include total token usage across all beads.\n\nThe agent_logs table already captures content with model info. Token counts may need to be parsed from the stream-json content field or from the existing token_count column (currently unpopulated).","status":"closed","priority":2,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T22:12:12Z","created_by":"Chris Trower","updated_at":"2026-02-18T03:19:17Z","closed_at":"2026-02-18T03:19:17Z","close_reason":"Closed"}
{"id":"railyard-cwz.1","title":"Add InputTokens/OutputTokens fields to AgentLog model","description":"Add InputTokens and OutputTokens int fields to AgentLog struct in internal/models/agent_log.go. Update model tests.","status":"closed","priority":2,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-18T03:12:55Z","created_by":"Chris Trower","updated_at":"2026-02-18T03:13:48Z","closed_at":"2026-02-18T03:13:48Z","close_reason":"Closed","dependencies":[{"issue_id":"railyard-cwz.1","depends_on_id":"railyard-cwz","type":"parent-child","created_at":"2026-02-17T21:12:54Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cwz.2","title":"Parse token usage from stream-json content","description":"New internal/engine/streamparse.go with ParseUsageFromContent(). Modify subprocess.go Flush() to call parser for stdout direction. Add tests.","status":"closed","priority":2,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-18T03:13:04Z","created_by":"Chris Trower","updated_at":"2026-02-18T03:15:01Z","closed_at":"2026-02-18T03:15:01Z","close_reason":"Closed","dependencies":[{"issue_id":"railyard-cwz.2","depends_on_id":"railyard-cwz","type":"parent-child","created_at":"2026-02-17T21:13:03Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-cwz.2","depends_on_id":"railyard-cwz.1","type":"blocks","created_at":"2026-02-17T21:13:10Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cwz.3","title":"Add token aggregation query functions","description":"New internal/car/tokens.go with GetTokenUsage() and CarTokenMap() plus tests.","status":"closed","priority":2,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-18T03:13:04Z","created_by":"Chris Trower","updated_at":"2026-02-18T03:17:01Z","closed_at":"2026-02-18T03:17:01Z","close_reason":"Closed","dependencies":[{"issue_id":"railyard-cwz.3","depends_on_id":"railyard-cwz","type":"parent-child","created_at":"2026-02-17T21:13:04Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-cwz.3","depends_on_id":"railyard-cwz.1","type":"blocks","created_at":"2026-02-17T21:13:11Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cwz.4","title":"Display token usage in ry car show and ry car list","description":"New cmd/ry/format.go with formatTokenCount and estimateCost helpers. Modify cmd/ry/car.go for show section and list --tokens flag.","status":"closed","priority":2,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-18T03:13:05Z","created_by":"Chris Trower","updated_at":"2026-02-18T03:19:17Z","closed_at":"2026-02-18T03:19:17Z","close_reason":"Closed","dependencies":[{"issue_id":"railyard-cwz.4","depends_on_id":"railyard-cwz","type":"parent-child","created_at":"2026-02-17T21:13:04Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-cwz.4","depends_on_id":"railyard-cwz.2","type":"blocks","created_at":"2026-02-17T21:13:11Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-cwz.4","depends_on_id":"railyard-cwz.3","type":"blocks","created_at":"2026-02-17T21:13:12Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-cwz.5","title":"Display token totals in ry status","description":"Modify orchestration.go StatusInfo, Status(), and FormatStatus() to include token totals.","status":"closed","priority":2,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-18T03:13:06Z","created_by":"Chris Trower","updated_at":"2026-02-18T03:19:17Z","closed_at":"2026-02-18T03:19:17Z","close_reason":"Closed","dependencies":[{"issue_id":"railyard-cwz.5","depends_on_id":"railyard-cwz","type":"parent-child","created_at":"2026-02-17T21:13:05Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-cwz.5","depends_on_id":"railyard-cwz.1","type":"blocks","created_at":"2026-02-17T21:13:12Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-d88","title":"Foundation — Dolt Database \u0026 Project Scaffold","description":"Bedrock of the entire Railyard system. Establishes Go project structure, all GORM models, config loading, Dolt connectivity, and the ry db init command. Every subsequent epic depends on this. Directory layout follows Go conventions: cmd/ry/ for CLI entrypoint, internal/ for private packages (models, db, config, bead, engine, messaging, yardmaster, dispatch). GORM models defined per ARCHITECTURE.md Section 1.5. Config is YAML-based per ARCHITECTURE.md VM Provisioning section. See IMPLEMENTATION_PLAN.md Epic 1 for full details.","design":"See ARCHITECTURE.md Section 1 (Dolt), Section 1.5 (GORM), Section 2 (Schema), and VM Provisioning (config.yaml)","acceptance_criteria":"ry db init creates railyard_{owner} database in Dolt with all tables. Tracks from config.yaml are seeded. RailyardConfig row written. Tables queryable via mysql client. \u003e90% test coverage for internal/config/ and internal/db/.","status":"closed","priority":0,"issue_type":"epic","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:01:48Z","created_by":"Chris Trower","updated_at":"2026-02-15T04:09:03Z","closed_at":"2026-02-15T04:09:03Z","close_reason":"All 5 children complete. Project scaffold, config system, GORM models, DB connection/init, and test suite all delivered. Config 100% coverage, DB 95.2% coverage.","labels":["foundation","phase-1"]}
{"id":"railyard-d88.1","title":"Project Scaffold \u0026 Dependencies","description":"Initialize Go module, establish canonical directory structure, add all core dependencies. Creates the skeleton every subsequent feature builds on. Layout: cmd/ry/main.go (CLI entrypoint), internal/models/ (GORM structs), internal/db/ (connection + migration), internal/config/ (YAML loading), internal/bead/ (bead operations), internal/engine/ (engine daemon), internal/messaging/ (agent communication), internal/yardmaster/ (supervisor), internal/dispatch/ (planner).","acceptance_criteria":"go mod init complete. All directories created. cmd/ry/main.go with minimal cobra root command that prints version. go build ./cmd/ry produces working binary. All dependencies resolvable. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:01:53Z","created_by":"Chris Trower","updated_at":"2026-02-15T03:12:09Z","closed_at":"2026-02-15T03:12:09Z","close_reason":"Closed","labels":["foundation","phase-1","scaffold"],"dependencies":[{"issue_id":"railyard-d88.1","depends_on_id":"railyard-d88","type":"parent-child","created_at":"2026-02-14T20:01:52Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-d88.1.1","title":"Initialize Go module and directory structure","description":"Create go.mod with go mod init github.com/zulandar/railyard. Create all directories: cmd/ry/, internal/models/, internal/db/, internal/config/, internal/bead/, internal/engine/, internal/messaging/, internal/yardmaster/, internal/dispatch/. Add cmd/ry/main.go with a minimal cobra root command that prints version info. Verify go build ./cmd/ry produces a working binary.","acceptance_criteria":"go.mod exists with correct module path. All directories exist. go build ./cmd/ry succeeds. Running the binary prints version. \u003e90% test coverage for any testable code.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:01:53Z","created_by":"Chris Trower","updated_at":"2026-02-15T03:12:05Z","closed_at":"2026-02-15T03:12:05Z","close_reason":"Closed","labels":["foundation","phase-1","scaffold"],"dependencies":[{"issue_id":"railyard-d88.1.1","depends_on_id":"railyard-d88.1","type":"parent-child","created_at":"2026-02-14T20:01:53Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-d88.1.2","title":"Add core dependencies","description":"go get for: gorm.io/gorm, gorm.io/driver/mysql (Dolt is MySQL-compatible), github.com/spf13/cobra (CLI framework), gopkg.in/yaml.v3 (config parsing). Create go.sum. Verify all imports resolve with go build.","acceptance_criteria":"go.sum exists. All four dependencies listed in go.mod. go build ./cmd/ry succeeds with all imports. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:01:54Z","created_by":"Chris Trower","updated_at":"2026-02-15T03:12:05Z","closed_at":"2026-02-15T03:12:05Z","close_reason":"Closed","labels":["foundation","phase-1","scaffold"],"dependencies":[{"issue_id":"railyard-d88.1.2","depends_on_id":"railyard-d88.1","type":"parent-child","created_at":"2026-02-14T20:01:54Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-d88.2","title":"Configuration System","description":"YAML-based configuration loader reading config.yaml. Config struct mirrors ARCHITECTURE.md VM Provisioning section: owner, repo, branch_prefix, dolt connection (host/port/database), tracks (name, language, file_patterns, engine_slots, conventions). Validates required fields, provides sensible defaults. Excludes provisioner section (production mode, out of scope).","acceptance_criteria":"Load() reads valid YAML and returns typed Config. Missing required fields return clear errors. Defaults applied (dolt host=127.0.0.1, port=3306). \u003e90% test coverage for internal/config/.","status":"closed","priority":0,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:01:55Z","created_by":"Chris Trower","updated_at":"2026-02-15T03:22:29Z","closed_at":"2026-02-15T03:22:29Z","close_reason":"Both children complete - config struct, loader, validation, and defaults all implemented with 100% coverage","labels":["config","foundation","phase-1"],"dependencies":[{"issue_id":"railyard-d88.2","depends_on_id":"railyard-d88","type":"parent-child","created_at":"2026-02-14T20:01:54Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-d88.2","depends_on_id":"railyard-d88.1","type":"blocks","created_at":"2026-02-14T20:03:08Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-d88.2.1","title":"Define config struct and YAML schema","description":"Create internal/config/config.go with Config, DoltConfig, TrackConfig structs. YAML tags for unmarshalling. Fields from ARCHITECTURE.md config.yaml: owner (string, required), repo (string, required), branch_prefix (string, derived from owner), dolt.host (string, default 127.0.0.1), dolt.port (int, default 3306), dolt.database (string, derived railyard_{owner}), tracks[] with name/language/file_patterns/engine_slots/conventions. Exclude provisioner section.","acceptance_criteria":"Config struct compiles. YAML tags correct. All ARCHITECTURE.md config fields present (minus provisioner). \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:01:56Z","created_by":"Chris Trower","updated_at":"2026-02-15T03:18:36Z","closed_at":"2026-02-15T03:18:36Z","close_reason":"Closed","labels":["config","foundation","phase-1"],"dependencies":[{"issue_id":"railyard-d88.2.1","depends_on_id":"railyard-d88.2","type":"parent-child","created_at":"2026-02-14T20:01:55Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-d88.2.2","title":"Implement config loader with validation","description":"Implement Load(path string) (*Config, error) in internal/config/config.go. Reads YAML file, unmarshals into Config struct, validates required fields (owner, repo, at least one track), applies defaults (dolt host=127.0.0.1, port=3306, database=railyard_{owner}, branch_prefix=ry/{owner}). Returns clear error messages for missing/invalid fields.","acceptance_criteria":"Load() with valid config returns correct struct. Load() with missing owner returns error mentioning 'owner'. Load() with no tracks returns error. Defaults applied when fields omitted. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:01:56Z","created_by":"Chris Trower","updated_at":"2026-02-15T03:22:25Z","closed_at":"2026-02-15T03:22:25Z","close_reason":"Already fully implemented in d88.2.1 commit - Load/Parse/validate/applyDefaults all present with 100% test coverage","labels":["config","foundation","phase-1"],"dependencies":[{"issue_id":"railyard-d88.2.2","depends_on_id":"railyard-d88.2","type":"parent-child","created_at":"2026-02-14T20:01:56Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-d88.3","title":"GORM Data Models","description":"All Phase 1 GORM model structs exactly as specified in ARCHITECTURE.md Section 1.5. These are the single source of truth for database schema — GORM AutoMigrate creates tables from them. Models: Bead, BeadDep, BeadProgress, Track, Engine, Message, AgentLog, RailyardConfig, ReindexJob. Excludes BeadDepExternal (Phase 2).","acceptance_criteria":"All 9 model structs compile. GORM tags match ARCHITECTURE.md exactly. Relations defined (Bead.Parent, Bead.Children, Bead.Deps, Bead.Progress). \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:01:57Z","created_by":"Chris Trower","updated_at":"2026-02-15T03:37:25Z","closed_at":"2026-02-15T03:37:25Z","close_reason":"Closed","labels":["foundation","models","phase-1"],"dependencies":[{"issue_id":"railyard-d88.3","depends_on_id":"railyard-d88","type":"parent-child","created_at":"2026-02-14T20:01:57Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-d88.3","depends_on_id":"railyard-d88.2","type":"blocks","created_at":"2026-02-14T20:03:09Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-d88.3.1","title":"Implement core work item models (Bead, BeadDep, BeadProgress)","description":"Create internal/models/bead.go with Bead, BeadDep, BeadProgress structs. All fields and GORM tags exactly per ARCHITECTURE.md Section 1.5. Bead: ID (primaryKey, size:32), Title (not null), Description (text), Type (size:16, default:task), Status (size:16, default:open, index), Priority (default:2), Track (size:64, index), Assignee (size:64), ParentID (*string, size:32), Branch (size:128), DesignNotes (text), Acceptance (text), timestamps, ClaimedAt/CompletedAt (*time.Time). Relations: Parent, Children, Deps, Progress.","acceptance_criteria":"Structs compile. All fields present with correct GORM tags. Foreign key relations defined. BeadDep has composite primary key (BeadID, BlockedBy). BeadProgress has auto-increment ID. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:01:58Z","created_by":"Chris Trower","updated_at":"2026-02-15T03:37:22Z","closed_at":"2026-02-15T03:37:22Z","close_reason":"Closed","labels":["foundation","models","phase-1"],"dependencies":[{"issue_id":"railyard-d88.3.1","depends_on_id":"railyard-d88.3","type":"parent-child","created_at":"2026-02-14T20:01:57Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-d88.3.2","title":"Implement infrastructure models (Track, Engine, Message, AgentLog, Config, ReindexJob)","description":"Create separate files in internal/models/: track.go (Track struct), engine.go (Engine), message.go (Message), agent_log.go (AgentLog), config.go (RailyardConfig), reindex_job.go (ReindexJob). All fields per ARCHITECTURE.md Section 1.5. Track: Name (primaryKey), Language, Conventions (json), SystemPrompt (text), FilePatterns (json), EngineSlots (default:3), Active (default:true). Engine: ID, VMID, Track, Role, Status, CurrentBead, SessionID, timestamps. Message: ID (auto), FromAgent, ToAgent (index), BeadID, ThreadID, Subject, Body, Priority, Acknowledged (index), timestamps. AgentLog: ID, EngineID+SessionID (composite index), BeadID (index), Direction, Content (mediumtext), TokenCount, Model, LatencyMs, timestamp. RailyardConfig: ID, Owner (uniqueIndex), RepoURL, Mode, Settings (json). ReindexJob: ID, Track, TriggerCommit, Status, FilesChanged, ChunksUpdated, GPUBoxID, timestamps, ErrorMessage.","acceptance_criteria":"All 6 model structs compile with correct GORM tags per ARCHITECTURE.md. Indexes defined. JSON fields typed correctly. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:01:59Z","created_by":"Chris Trower","updated_at":"2026-02-15T03:37:22Z","closed_at":"2026-02-15T03:37:22Z","close_reason":"Closed","labels":["foundation","models","phase-1"],"dependencies":[{"issue_id":"railyard-d88.3.2","depends_on_id":"railyard-d88.3","type":"parent-child","created_at":"2026-02-14T20:01:58Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-d88.4","title":"Database Connection \u0026 Initialization","description":"Dolt connection layer using GORM MySQL driver, AutoMigrate for all tables, track seeding from config, and the ry db init CLI command. This is the first runnable CLI command. Connection follows ARCHITECTURE.md Section 1.5 setup.","acceptance_criteria":"ry db init creates railyard_{owner} database, migrates all tables, seeds tracks, writes RailyardConfig. Tables queryable via mysql client. Idempotent (safe to run twice). \u003e90% test coverage for internal/db/.","status":"closed","priority":0,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:01:59Z","created_by":"Chris Trower","updated_at":"2026-02-15T03:37:25Z","closed_at":"2026-02-15T03:37:25Z","close_reason":"Closed","labels":["database","foundation","phase-1"],"dependencies":[{"issue_id":"railyard-d88.4","depends_on_id":"railyard-d88","type":"parent-child","created_at":"2026-02-14T20:01:59Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-d88.4","depends_on_id":"railyard-d88.3","type":"blocks","created_at":"2026-02-14T20:03:10Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-d88.4.1","title":"Implement Dolt connection function","description":"Create internal/db/connect.go with Connect(owner, host string, port int) (*gorm.DB, error). DSN format: root@tcp(host:port)/railyard_{owner}?parseTime=true. Handle connection errors with clear messages (Dolt not running, wrong port, database not found). Follows ARCHITECTURE.md Section 1.5 connection setup exactly.","acceptance_criteria":"Connect() returns valid *gorm.DB when Dolt is running. Returns clear error when Dolt is not running. DSN format matches ARCHITECTURE.md. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:00Z","created_by":"Chris Trower","updated_at":"2026-02-15T03:37:22Z","closed_at":"2026-02-15T03:37:22Z","close_reason":"Closed","labels":["database","foundation","phase-1"],"dependencies":[{"issue_id":"railyard-d88.4.1","depends_on_id":"railyard-d88.4","type":"parent-child","created_at":"2026-02-14T20:02:00Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-d88.4.2","title":"Implement AutoMigrate and track seeding","description":"Create internal/db/migrate.go with: AutoMigrate(db *gorm.DB) error — migrates all 9 Phase 1 models (Bead, BeadDep, BeadProgress, Track, Engine, Message, AgentLog, RailyardConfig, ReindexJob). SeedTracks(db *gorm.DB, tracks []config.TrackConfig) error — upserts Track rows from config. SeedConfig(db *gorm.DB, cfg *config.Config) error — writes/updates RailyardConfig row.","acceptance_criteria":"AutoMigrate creates all 9 tables in Dolt. SeedTracks populates tracks table from config. SeedConfig writes config row. All idempotent. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:01Z","created_by":"Chris Trower","updated_at":"2026-02-15T03:37:22Z","closed_at":"2026-02-15T03:37:22Z","close_reason":"Closed","labels":["database","foundation","phase-1"],"dependencies":[{"issue_id":"railyard-d88.4.2","depends_on_id":"railyard-d88.4","type":"parent-child","created_at":"2026-02-14T20:02:00Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-d88.4.3","title":"Implement ry db init CLI command","description":"Add 'db init' subcommand to cobra CLI in cmd/ry/. Flow: load config from config.yaml (or --config flag) → create Dolt database via CREATE DATABASE IF NOT EXISTS railyard_{owner} → connect with GORM → run AutoMigrate → seed tracks from config → seed RailyardConfig → print summary (tables created, tracks seeded, config written). First runnable command in the system.","acceptance_criteria":"ry db init creates database and all tables. Prints human-readable summary. Idempotent. --config flag overrides default path. Errors clearly if Dolt not running. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:02Z","created_by":"Chris Trower","updated_at":"2026-02-15T03:37:22Z","closed_at":"2026-02-15T03:37:22Z","close_reason":"Closed","labels":["database","foundation","phase-1"],"dependencies":[{"issue_id":"railyard-d88.4.3","depends_on_id":"railyard-d88.4","type":"parent-child","created_at":"2026-02-14T20:02:01Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-d88.5","title":"Foundation Test Suite","description":"Unit and integration tests for the foundation layer. Config tests use fixture YAML files in testdata/. Database tests require running Dolt instance. Target \u003e90% coverage for internal/config/ and internal/db/.","acceptance_criteria":"\u003e90% test coverage for internal/config/ and internal/db/. All tests pass. Integration tests documented with setup requirements.","status":"closed","priority":1,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:02Z","created_by":"Chris Trower","updated_at":"2026-02-15T04:04:15Z","closed_at":"2026-02-15T04:04:15Z","close_reason":"Both children complete. Config: 100% coverage with testdata fixtures. DB: 95.2% coverage with integration tests (build-tagged). All acceptance criteria met.","labels":["foundation","phase-1","testing"],"dependencies":[{"issue_id":"railyard-d88.5","depends_on_id":"railyard-d88","type":"parent-child","created_at":"2026-02-14T20:02:02Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-d88.5","depends_on_id":"railyard-d88.4","type":"blocks","created_at":"2026-02-14T20:03:11Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-d88.5.1","title":"Config loading unit tests","description":"Create internal/config/config_test.go. Test cases: valid config loads correctly with all fields, missing required fields (owner, repo) return descriptive errors, defaults applied when optional fields omitted (dolt host, port, database), invalid YAML returns parse error, empty tracks array returns error. Use fixture YAML files in testdata/ directory.","acceptance_criteria":"All test cases pass. \u003e90% line coverage for internal/config/. Fixture files in testdata/. go test -cover ./internal/config/ shows coverage.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:03Z","created_by":"Chris Trower","updated_at":"2026-02-15T04:04:09Z","closed_at":"2026-02-15T04:04:09Z","close_reason":"Config tests at 100% coverage. Testdata fixtures added in testdata/. All test cases pass.","labels":["foundation","phase-1","testing"],"dependencies":[{"issue_id":"railyard-d88.5.1","depends_on_id":"railyard-d88.5","type":"parent-child","created_at":"2026-02-14T20:02:03Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-d88.5.2","title":"Database initialization integration tests","description":"Create internal/db/db_test.go. Requires running Dolt server. Test cases: Connect() succeeds with valid params, AutoMigrate creates all 9 tables with correct columns, SeedTracks populates tracks from config, SeedConfig writes RailyardConfig row, idempotent (running twice doesn't error). Test helper to start/stop Dolt or use Docker. Build tag for integration tests.","acceptance_criteria":"All integration tests pass with Dolt running. \u003e90% line coverage for internal/db/. Test helper manages Dolt lifecycle. Tests tagged for CI skip if Dolt unavailable.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:04Z","created_by":"Chris Trower","updated_at":"2026-02-15T04:04:10Z","closed_at":"2026-02-15T04:04:10Z","close_reason":"Integration tests at 95.2% coverage (\u003e90% target). Tests: ConnectAdmin, CreateDatabase, Connect, AutoMigrate (tables+columns), SeedTracks, SeedConfig, idempotency, upsert updates, error paths. Build-tagged with //go:build integration. Fixed SeedConfig bug (empty JSON Settings field).","labels":["foundation","phase-1","testing"],"dependencies":[{"issue_id":"railyard-d88.5.2","depends_on_id":"railyard-d88.5","type":"parent-child","created_at":"2026-02-14T20:02:03Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-dyo","title":"Document Dolt restart after WSL reboot","description":"Dolt is started with nohup in quickstart.sh, which means it dies when WSL shuts down. There is no guidance on restarting it. Add a note in quickstart output about this, and consider adding a ry dolt start convenience command or documenting the manual restart procedure.","status":"closed","priority":3,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T20:11:48Z","created_by":"Chris Trower","updated_at":"2026-02-17T00:46:22Z","closed_at":"2026-02-17T00:46:22Z","close_reason":"Added ry db start command and reboot warning in quickstart output"}
{"id":"railyard-e07","title":"test issue","status":"closed","priority":2,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T00:27:57Z","created_by":"Chris Trower","updated_at":"2026-02-15T18:36:35Z","closed_at":"2026-02-15T18:36:35Z","close_reason":"Test issue, not needed"}
{"id":"railyard-f3r","title":"Stalled engine recovery: teach agents ry engine restart and fix stale car claims","description":"## Problem\n\nMultiple issues around stalled engine recovery:\n\n1. **Dispatch used `ry start` to restart a stalled engine** — this starts the full orchestration (Dispatch + Yardmaster + engines) instead of restarting just one engine. Dispatch doesn't know about `ry engine restart \u003cengine-id\u003e`.\n\n2. **Yardmaster prompt doesn't include `ry engine restart`** — the yardmaster prompt (`internal/yardmaster/prompt.go`) has a 'Stalled Engine' decision rule that marks engines dead and releases cars, but never restarts them. The command exists (`orchestration.RestartEngine()`) but yardmaster doesn't know about it.\n\n3. **Stale car claims create re-claim loops** — when HandleStall marks a car as 'blocked' and the engine is still alive, the engine daemon's `claimOrReclaim()` (`cmd/ry/engine.go:339`) re-claims it because 'blocked' != 'done'/'cancelled'. The engine loops trying to work on a blocked car forever.\n\n4. **Done cars stuck as claimed** — if a car reaches status 'done' but the engine's `current_car` field wasn't cleared (e.g., process died between completion and cleanup), yardmaster should detect and clean this up so the engine can move on.\n\n5. **Dispatch shouldn't manage engines directly** — engine lifecycle is yardmaster's job. Dispatch should know to describe the problem and let yardmaster handle it, or at most use `ry engine restart`.\n\n## Changes Required\n\n### 1. Yardmaster prompt (`internal/yardmaster/prompt.go`)\n- Add `ry engine restart \u003cengine-id\u003e` to Available Commands section\n- Update 'Stalled Engine' decision rule: after releasing the car, restart the engine (not just mark dead)\n- Add new decision rule 'Stale Car Claim': if car status=done but engine still has it as current_car, clear the claim (`ry car update \u003cid\u003e --assignee \"\"`)\n- Add `ry engine list` and `ry engine restart` to the monitoring loop\n\n### 2. Engine daemon stall recovery (`cmd/ry/engine.go`)\n- In the `outcomeStall` case (line 280), after HandleStall, also clear `eng.CurrentCar` and update the DB so the engine doesn't re-claim the blocked car\n- In `claimOrReclaim()`, add 'blocked' to the statuses that trigger clearing current_car (alongside 'done' and 'cancelled')\n\n### 3. Dispatch prompt (`internal/dispatch/prompt.go`)\n- Add a brief note that engine management (restarts, stall recovery) is yardmaster's responsibility\n- If Dispatch needs an engine restarted, it should message yardmaster rather than using `ry start`\n\n## Acceptance Criteria\n- [ ] Yardmaster prompt includes `ry engine restart \u003cengine-id\u003e` in available commands\n- [ ] Yardmaster 'Stalled Engine' rule uses restart instead of just marking dead\n- [ ] Yardmaster has 'Stale Car Claim' detection rule\n- [ ] Engine daemon clears current_car after stall outcome (no re-claim loop)\n- [ ] `claimOrReclaim()` treats 'blocked' as a terminal status (clears current_car)\n- [ ] Dispatch prompt notes that engine lifecycle = yardmaster responsibility\n- [ ] Existing tests still pass","status":"closed","priority":2,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-16T21:46:51Z","created_by":"Chris Trower","updated_at":"2026-02-16T22:14:18Z","closed_at":"2026-02-16T22:14:18Z","close_reason":"Implemented .claudeignore in worktrees, fixed stall re-claim loop, added engine restart to yardmaster/dispatch prompts"}
{"id":"railyard-i1i","title":"Bug: Yardmaster detects stalled engines but never restarts them","description":"The yardmaster daemon loop (Phase 2: handleStaleEngines in daemon.go:228-252) detects engines with stale heartbeats (\u003e60s no activity) and reassigns their cars via ReassignCar(), but only marks the engine as dead — it never restarts the engine. Similarly, when yardmaster receives engine-stalled messages from the engine's own stall detector, it just writes a progress note and acks the message without restarting.\n\norchestration.RestartEngine() exists (scale.go:262-299) and correctly kills the old engine, marks it dead, creates a new tmux pane, and starts a replacement engine on the same track. But it's never called from the daemon's stale engine handler.\n\nRoot cause: handleStaleEngines() in daemon.go calls ReassignCar() (which marks engine dead and releases the car) but doesn't call RestartEngine() to spawn a replacement. The engine-stalled inbox handler also doesn't restart.\n\nFix:\n1. Thread configPath into handleStaleEngines() (already available in daemon loop scope since railyard-vxg)\n2. After ReassignCar(), call orchestration.RestartEngine(db, configPath, eng.ID, nil) to spawn a replacement engine on the same track\n3. In the engine-stalled inbox handler (daemon.go processInbox), also call RestartEngine() after writing the progress note\n4. Make restart failures non-fatal (log the error, don't break the daemon loop)\n5. Add a configurable stale threshold (currently hardcoded at 60s in health.go)\n\nKey files:\n- internal/yardmaster/daemon.go — handleStaleEngines(), processInbox engine-stalled case\n- internal/yardmaster/health.go — CheckEngineHealth(), DefaultStaleThreshold\n- internal/orchestration/scale.go — RestartEngine()\n- internal/engine/stall.go — StallDetector (engine-side, sends engine-stalled message)\n\nAcceptance criteria:\n- [ ] handleStaleEngines() calls RestartEngine() after reassigning the car\n- [ ] engine-stalled inbox handler also restarts the stalled engine\n- [ ] Restart failures are logged but don't crash the daemon loop\n- [ ] If the engine has no current car (idle stall), still restart it\n- [ ] Existing tests still pass (go test ./...)\n- [ ] Add test covering the restart path in handleStaleEngines","status":"closed","priority":1,"issue_type":"bug","owner":"chris.trower@outlook.com","created_at":"2026-02-17T04:21:29Z","created_by":"Chris Trower","updated_at":"2026-02-17T04:23:05Z","closed_at":"2026-02-17T04:23:05Z","close_reason":"handleStaleEngines now calls RestartEngine() after reassigning cars. engine-stalled inbox handler also restarts. Failures are logged but non-fatal."}
{"id":"railyard-i3n","title":"Messaging — Agent-to-Agent Communication","description":"Agent-to-agent communication via direct DB polling (ARCHITECTURE.md Messaging section, Option A). Messages are rows in the messages table. Agents poll every 5s. Supports threading (parent-child messages), broadcast (to all engines), and acknowledgement. Integrates into engine daemon main loop for processing yardmaster instructions. See IMPLEMENTATION_PLAN.md Epic 4.","design":"See ARCHITECTURE.md Section Messaging: Kafka vs Direct DB — using Option A (Direct DB)","acceptance_criteria":"Engine sends message to yardmaster, yardmaster reads it, acknowledges. Broadcast delivers to all agents. Threading chains replies correctly. Engine loop processes inbox before claiming work. \u003e90% test coverage for internal/messaging/.","status":"closed","priority":1,"issue_type":"epic","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:01:50Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:00:10Z","closed_at":"2026-02-15T17:00:10Z","close_reason":"All children complete. 100% test coverage for internal/messaging/.","labels":["messaging","phase-1"],"dependencies":[{"issue_id":"railyard-i3n","depends_on_id":"railyard-lwt","type":"blocks","created_at":"2026-02-14T20:03:05Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-i3n.1","title":"Message Core Functions","description":"internal/messaging/ package: Send, Inbox, Acknowledge, threading, broadcast. Messages have from_agent, to_agent, subject, body, bead_id (optional), thread_id (optional), priority, acknowledged flag. See ARCHITECTURE.md Messaging section.","acceptance_criteria":"Send creates message row. Inbox returns unacknowledged messages ordered by priority. Acknowledge marks processed. Threading chains replies. Broadcast reaches all agents. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:28Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:20:04Z","closed_at":"2026-02-15T06:20:04Z","close_reason":"Send/Inbox/Acknowledge with priority ordering, GetThread/Reply threading, broadcast with BroadcastAck table, AcknowledgeBroadcast. All 10 unit tests pass.","labels":["core","messaging","phase-1"],"dependencies":[{"issue_id":"railyard-i3n.1","depends_on_id":"railyard-i3n","type":"parent-child","created_at":"2026-02-14T20:02:28Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-i3n.1","depends_on_id":"railyard-lwt.1","type":"blocks","created_at":"2026-02-14T20:03:18Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-i3n.1.1","title":"Implement messaging package (Send, Inbox, Acknowledge)","description":"Create internal/messaging/messaging.go. Send(db, from, to, subject, body string, opts ...SendOption) (*models.Message, error) — creates message row with optional beadID, threadID, priority. Inbox(db, agentID string) ([]models.Message, error) — SELECT WHERE to_agent=agentID AND acknowledged=false ORDER BY priority ASC, created_at ASC. Acknowledge(db, messageID uint) error — UPDATE SET acknowledged=true.","acceptance_criteria":"Send creates message. Inbox returns unacknowledged only. Acknowledge removes from inbox. Priority ordering works. SendOptions work (beadID, threadID). \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:29Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:20:04Z","closed_at":"2026-02-15T06:20:04Z","close_reason":"Send/Inbox/Acknowledge with priority ordering, GetThread/Reply threading, broadcast with BroadcastAck table, AcknowledgeBroadcast. All 10 unit tests pass.","labels":["core","messaging","phase-1"],"dependencies":[{"issue_id":"railyard-i3n.1.1","depends_on_id":"railyard-i3n.1","type":"parent-child","created_at":"2026-02-14T20:02:29Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-i3n.1.2","title":"Implement threading support","description":"GetThread(db *gorm.DB, threadID uint) ([]models.Message, error) — returns all messages with matching ThreadID ordered by created_at ASC. Reply(db, parentMsgID uint, from, body string) (*models.Message, error) — creates reply: same ThreadID (or set to parent ID if first reply), same to_agent as parent from_agent, subject='Re: ' + parent subject.","acceptance_criteria":"GetThread returns full chain. Reply creates correctly linked message. Thread ID propagated through chain. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:30Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:20:04Z","closed_at":"2026-02-15T06:20:04Z","close_reason":"Send/Inbox/Acknowledge with priority ordering, GetThread/Reply threading, broadcast with BroadcastAck table, AcknowledgeBroadcast. All 10 unit tests pass.","labels":["core","messaging","phase-1"],"dependencies":[{"issue_id":"railyard-i3n.1.2","depends_on_id":"railyard-i3n.1","type":"parent-child","created_at":"2026-02-14T20:02:29Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-i3n.1.3","title":"Implement broadcast messages","description":"When to_agent='broadcast', Inbox() for ANY agent returns the message until that agent acknowledges it. Implementation: Inbox query includes WHERE to_agent=agentID OR (to_agent='broadcast' AND id NOT IN (SELECT message_id FROM broadcast_acks WHERE agent_id=agentID)). Create broadcast_acks table or use simple approach: broadcast messages appear for all, each agent acks independently.","acceptance_criteria":"Broadcast message appears in every agent inbox. Each agent acknowledges independently. Acknowledged broadcast does not reappear for that agent. Still appears for others. \u003e90% test coverage.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:31Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:20:04Z","closed_at":"2026-02-15T06:20:04Z","close_reason":"Send/Inbox/Acknowledge with priority ordering, GetThread/Reply threading, broadcast with BroadcastAck table, AcknowledgeBroadcast. All 10 unit tests pass.","labels":["core","messaging","phase-1"],"dependencies":[{"issue_id":"railyard-i3n.1.3","depends_on_id":"railyard-i3n.1","type":"parent-child","created_at":"2026-02-14T20:02:30Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-i3n.2","title":"Engine Inbox Integration","description":"Engine daemon checks inbox at start of each loop iteration. Yardmaster instructions processed before claiming new work. Instruction types: abort, switch-track, pause, resume, guidance.","acceptance_criteria":"Engine polls inbox each loop. Yardmaster instructions processed correctly. Abort stops current bead. Pause/resume work. Unknown message types logged and acked. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:31Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:25:16Z","closed_at":"2026-02-15T06:25:16Z","close_reason":"Closed","labels":["engine","messaging","phase-1"],"dependencies":[{"issue_id":"railyard-i3n.2","depends_on_id":"railyard-i3n","type":"parent-child","created_at":"2026-02-14T20:02:31Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-i3n.2","depends_on_id":"railyard-i3n.1","type":"blocks","created_at":"2026-02-14T20:03:19Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-i3n.2.1","title":"Integrate inbox polling into engine main loop","description":"Modify engine daemon loop from Epic 3: after heartbeat update, before bead claim step, call messaging.Inbox(db, engineID). Process each message. Acknowledge after processing. If abort instruction received, stop current bead work and mark bead as blocked.","acceptance_criteria":"Engine checks inbox every loop iteration. Messages processed before claim. Acknowledged after processing. No messages = no-op, continues to claim. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:32Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:25:16Z","closed_at":"2026-02-15T06:25:16Z","close_reason":"Closed","labels":["engine","messaging","phase-1"],"dependencies":[{"issue_id":"railyard-i3n.2.1","depends_on_id":"railyard-i3n.2","type":"parent-child","created_at":"2026-02-14T20:02:32Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-i3n.2.2","title":"Implement yardmaster instruction processing","description":"Handle known instruction types from yardmaster messages (identified by subject prefix or convention): 'abort' — stop current bead, mark blocked, release claim. 'switch-track' — change engine track in engines table, release current bead if any. 'pause' — set flag to stop claiming new beads (but finish current). 'resume' — clear pause flag. 'guidance' — log advice text, inject into next context render. Unknown types logged and acknowledged.","acceptance_criteria":"Each instruction type handled correctly. Abort releases bead. Switch-track changes engine track. Pause/resume toggle claiming. Guidance stored for injection. Unknown types don't crash. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:33Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:25:16Z","closed_at":"2026-02-15T06:25:16Z","close_reason":"Closed","labels":["engine","messaging","phase-1"],"dependencies":[{"issue_id":"railyard-i3n.2.2","depends_on_id":"railyard-i3n.2","type":"parent-child","created_at":"2026-02-14T20:02:32Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-i3n.3","title":"Messaging CLI Commands","description":"Manual messaging CLI for debugging and human intervention. Send messages to any agent, read any agent inbox, acknowledge messages.","acceptance_criteria":"ry message send/inbox/ack work from command line. Thread view shows conversation. \u003e90% test coverage.","status":"closed","priority":1,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:34Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:35:01Z","closed_at":"2026-02-15T06:35:01Z","close_reason":"Closed","labels":["cli","messaging","phase-1"],"dependencies":[{"issue_id":"railyard-i3n.3","depends_on_id":"railyard-i3n","type":"parent-child","created_at":"2026-02-14T20:02:33Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-i3n.3","depends_on_id":"railyard-i3n.2","type":"blocks","created_at":"2026-02-14T20:03:19Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-i3n.3.1","title":"Implement ry message send, ry inbox, ry message ack","description":"ry message send --from human --to yardmaster --subject 'need help' --body 'engine stuck on test failures'. ry inbox --agent yardmaster — lists unacknowledged messages with ID, from, subject, timestamp. ry message ack \u003cid\u003e — acknowledges message. ry message thread \u003cid\u003e — shows full conversation thread.","acceptance_criteria":"All CLI commands functional. Send creates message. Inbox shows correct messages. Ack removes from inbox. Thread shows chain. \u003e90% test coverage.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:34Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:35:01Z","closed_at":"2026-02-15T06:35:01Z","close_reason":"Closed","labels":["cli","messaging","phase-1"],"dependencies":[{"issue_id":"railyard-i3n.3.1","depends_on_id":"railyard-i3n.3","type":"parent-child","created_at":"2026-02-14T20:02:34Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-i3n.4","title":"Messaging Test Suite","description":"\u003e90% coverage for internal/messaging/. Unit tests for CRUD, threading, priority ordering. Integration tests for inbox polling in engine loop and broadcast delivery.","acceptance_criteria":"\u003e90% line coverage for internal/messaging/. All tests pass.","status":"closed","priority":1,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:35Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:00:05Z","closed_at":"2026-02-15T17:00:05Z","close_reason":"100% coverage for internal/messaging/. 21 integration tests + 10 unit tests all pass.","labels":["messaging","phase-1","testing"],"dependencies":[{"issue_id":"railyard-i3n.4","depends_on_id":"railyard-i3n","type":"parent-child","created_at":"2026-02-14T20:02:35Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-i3n.4","depends_on_id":"railyard-i3n.3","type":"blocks","created_at":"2026-02-14T20:03:20Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-i3n.4.1","title":"Unit tests for messaging operations","description":"Test: Send creates message with correct fields. Inbox returns unacknowledged only, ordered by priority then created_at. Acknowledge sets flag, message no longer in inbox. Reply creates correctly threaded message. GetThread returns ordered chain. Priority='urgent' sorts before 'normal'.","acceptance_criteria":"All unit tests pass. Edge cases: empty inbox, multiple messages same priority, thread with no replies. \u003e90% coverage.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:36Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:00:05Z","closed_at":"2026-02-15T17:00:05Z","close_reason":"100% coverage for internal/messaging/. 21 integration tests + 10 unit tests all pass.","labels":["messaging","phase-1","testing"],"dependencies":[{"issue_id":"railyard-i3n.4.1","depends_on_id":"railyard-i3n.4","type":"parent-child","created_at":"2026-02-14T20:02:35Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-i3n.4.2","title":"Integration tests for inbox polling and broadcast","description":"Integration tests with Dolt. Test: send message to engine, verify engine loop processes and acknowledges it. Broadcast message: send broadcast, verify appears in multiple agents' inboxes, each acks independently. Yardmaster instructions: send abort message to engine, verify bead released. Send pause, verify engine stops claiming.","acceptance_criteria":"Full inbox polling tested in engine loop context. Broadcast delivery verified. Instruction processing verified. \u003e90% coverage.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:37Z","created_by":"Chris Trower","updated_at":"2026-02-15T17:00:05Z","closed_at":"2026-02-15T17:00:05Z","close_reason":"100% coverage for internal/messaging/. 21 integration tests + 10 unit tests all pass.","labels":["messaging","phase-1","testing"],"dependencies":[{"issue_id":"railyard-i3n.4.2","depends_on_id":"railyard-i3n.4","type":"parent-child","created_at":"2026-02-14T20:02:36Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-iaq","title":"Developer experience improvements","description":"Quality-of-life improvements for local development: ry doctor command, consolidated script logic, CLI flag overrides, and optional SQLite fallback to eliminate the Dolt dependency for quick local testing.","status":"open","priority":2,"issue_type":"epic","owner":"chris.trower@outlook.com","created_at":"2026-02-15T20:11:10Z","created_by":"Chris Trower","updated_at":"2026-02-15T20:11:10Z"}
{"id":"railyard-iaq.1","title":"Add ry doctor command","description":"A diagnostic command that checks all prerequisites in one shot: Go version, Dolt installed + running, tmux available, Claude Code CLI available, port availability, database connectivity, ~/.local/bin in PATH. First thing users run when troubleshooting.","status":"closed","priority":2,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T20:11:43Z","created_by":"Chris Trower","updated_at":"2026-02-17T00:20:42Z","closed_at":"2026-02-17T00:20:42Z","close_reason":"Implemented ry doctor command with system prerequisite checks","dependencies":[{"issue_id":"railyard-iaq.1","depends_on_id":"railyard-iaq","type":"parent-child","created_at":"2026-02-15T14:11:43Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-iaq.2","title":"Consolidate quickstart script shared logic","description":"quickstart.sh and quickstart-test.sh duplicate prerequisite checking logic (Go, Dolt, tmux detection, color helpers, etc). Extract shared functions into scripts/common.sh that both scripts source.","status":"open","priority":3,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T20:11:47Z","created_by":"Chris Trower","updated_at":"2026-02-15T20:11:47Z","dependencies":[{"issue_id":"railyard-iaq.2","depends_on_id":"railyard-iaq","type":"parent-child","created_at":"2026-02-15T14:11:47Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-iaq.3","title":"Add --port flag override to ry CLI commands","description":"Currently the Dolt port is only configurable via railyard.yaml. For quick testing, add a --port flag to ry db init and ry start that overrides the config file value. Helps avoid port 3306 conflicts without editing YAML.","status":"open","priority":3,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T20:11:51Z","created_by":"Chris Trower","updated_at":"2026-02-15T20:11:51Z","dependencies":[{"issue_id":"railyard-iaq.3","depends_on_id":"railyard-iaq","type":"parent-child","created_at":"2026-02-15T14:11:50Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-iaq.4","title":"Add SQLite fallback for zero-dependency local dev","description":"go.mod already has gorm.io/driver/sqlite as a dependency. Offer a SQLite mode (no Dolt needed) for truly isolated environments. The GORM abstraction layer makes this straightforward — swap the Connect() call based on config. Could be triggered by dolt.driver: sqlite or ry start --sqlite.","status":"open","priority":4,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T20:11:55Z","created_by":"Chris Trower","updated_at":"2026-02-15T20:11:55Z","dependencies":[{"issue_id":"railyard-iaq.4","depends_on_id":"railyard-iaq","type":"parent-child","created_at":"2026-02-15T14:11:55Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-ixb","title":"Bug: Switch/merge fails when branch is checked out in engine worktree","description":"In internal/yardmaster/switch.go, the Switch() function fails when trying to check out a car's feature branch because the branch is still checked out in the engine's worktree at engines/\u003cengineID\u003e/.\n\nError: fatal: '\u003cbranch\u003e' is already checked out at '.../engines/\u003cengineID\u003e'\n\nRoot cause: runTests() (line ~68) does git checkout \u003cbranch\u003e in the main repo, but the engine's worktree still has that branch checked out. Git prevents a branch from being checked out in two worktrees simultaneously.\n\nFix: Before checking out the branch in runTests(), detach the engine's worktree HEAD. The car's Assignee field contains the engine ID, and worktrees live at \u003crepoDir\u003e/engines/\u003cengineID\u003e. Run git -C engines/\u003cengineID\u003e checkout --detach HEAD before the branch checkout in the main repo.\n\nKey files:\n- internal/yardmaster/switch.go — Switch(), runTests(), gitMerge() functions\n- internal/engine/git.go — worktree management (EnsureWorktree, RemoveWorktree)\n- The Switch function receives a *db.Car which has the Assignee field (engine ID)\n\nAcceptance criteria:\n- ry switch \u003ccar-id\u003e succeeds even when the engine worktree still has the branch checked out\n- If the engine worktree doesn't exist or is already detached, it should not error\n- Add a test case covering this scenario\n- Don't break existing tests (go test ./...)","status":"closed","priority":1,"issue_type":"bug","owner":"chris.trower@outlook.com","created_at":"2026-02-17T04:15:34Z","created_by":"Chris Trower","updated_at":"2026-02-17T04:17:13Z","closed_at":"2026-02-17T04:17:13Z","close_reason":"Added detachEngineWorktree() call before runTests() in Switch(). Gracefully handles missing/already-detached worktrees."}
{"id":"railyard-j0k","title":"Dispatch — Planner Agent","description":"User-facing planner agent that decomposes feature requests into structured bead plans across tracks with dependency chains. Dispatch is a Claude Code session with a planner prompt. Understands track boundaries (Go→backend, React→frontend, Terraform→infra). Creates epics, features, tasks with proper ordering. See ARCHITECTURE.md Section Dispatch (Agent1) and IMPLEMENTATION_PLAN.md Epic 6.","design":"See ARCHITECTURE.md Section Dispatch (Agent1) — example interaction shows decomposition pattern","acceptance_criteria":"Tell Dispatch 'Add user auth with JWT backend and login frontend.' It creates backend epic with tasks, frontend epic with tasks, and cross-track dependencies. Beads have title, description, acceptance, correct track, type, and parent. \u003e90% test coverage for internal/dispatch/.","status":"closed","priority":1,"issue_type":"epic","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:01:51Z","created_by":"Chris Trower","updated_at":"2026-02-15T16:56:18Z","closed_at":"2026-02-15T16:56:18Z","close_reason":"All children complete. 93.5% test coverage for internal/dispatch/.","labels":["dispatch","phase-1"],"dependencies":[{"issue_id":"railyard-j0k","depends_on_id":"railyard-lwt","type":"blocks","created_at":"2026-02-14T20:03:06Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-j0k.1","title":"Dispatch Agent Framework","description":"Dispatch package scaffold and system prompt. Claude Code session with planner prompt. Has access to ry bead create, ry bead dep add, track config. Interactive mode — user types requests. See ARCHITECTURE.md Dispatch section.","acceptance_criteria":"Dispatch starts as Claude Code session. System prompt includes track definitions and ry commands. Interactive mode works. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:49Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:20:06Z","closed_at":"2026-02-15T06:20:06Z","close_reason":"Dispatch scaffold with Start/BuildCommand, system prompt with track-aware template rendering (RenderPrompt), decomposition rules and example. 9 tests pass.","labels":["dispatch","framework","phase-1"],"dependencies":[{"issue_id":"railyard-j0k.1","depends_on_id":"railyard-j0k","type":"parent-child","created_at":"2026-02-14T20:02:49Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-j0k.1","depends_on_id":"railyard-lwt.4","type":"blocks","created_at":"2026-02-14T20:03:25Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-j0k.1.1","title":"Implement dispatch package scaffold","description":"Create internal/dispatch/dispatch.go. Start(db *gorm.DB, config *config.Config) error — loads system prompt, launches Claude Code in interactive mode (user types directly to it). Registers in engines table with role=dispatch. Manages subprocess: restart on crash, clean shutdown on signal.","acceptance_criteria":"Dispatch starts Claude Code interactively. User can type requests. Registered in engines table. Restart on crash. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:50Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:20:06Z","closed_at":"2026-02-15T06:20:06Z","close_reason":"Dispatch scaffold with Start/BuildCommand, system prompt with track-aware template rendering (RenderPrompt), decomposition rules and example. 9 tests pass.","labels":["dispatch","framework","phase-1"],"dependencies":[{"issue_id":"railyard-j0k.1.1","depends_on_id":"railyard-j0k.1","type":"parent-child","created_at":"2026-02-14T20:02:49Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-j0k.1.2","title":"Write dispatch system prompt with track awareness","description":"Create dispatch system prompt. Content: role (planner that decomposes user requests into beads across tracks), track definitions from config (for each track: name, language, conventions, file_patterns — so Dispatch knows what belongs where), available ry commands (ry bead create with all flags, ry bead dep add, ry bead list, ry bead ready, ry bead children), decomposition examples (from ARCHITECTURE.md Dispatch section — the auth example showing epic/task creation with cross-track deps), rules (one bead per atomic work unit, always set acceptance criteria with \u003e90% test coverage, always set dependencies, use epic for multi-task groups, use task for atomic units).","acceptance_criteria":"Prompt includes track definitions, ry commands, examples, and rules. Decomposition guidance clear. \u003e90% test coverage for prompt rendering.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:50Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:20:06Z","closed_at":"2026-02-15T06:20:06Z","close_reason":"Dispatch scaffold with Start/BuildCommand, system prompt with track-aware template rendering (RenderPrompt), decomposition rules and example. 9 tests pass.","labels":["dispatch","framework","phase-1"],"dependencies":[{"issue_id":"railyard-j0k.1.2","depends_on_id":"railyard-j0k.1","type":"parent-child","created_at":"2026-02-14T20:02:50Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-j0k.2","title":"Work Decomposition","description":"Prompt engineering and logic for Dispatch to decompose feature requests into structured bead hierarchies with dependency chains. Creates epics per track, tasks under each, proper ordering.","acceptance_criteria":"Dispatch creates correct bead structure from natural language requests. Cross-track dependencies set. No cycles. Acceptance criteria on every bead. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:51Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:25:16Z","closed_at":"2026-02-15T06:25:16Z","close_reason":"Closed","labels":["decomposition","dispatch","phase-1"],"dependencies":[{"issue_id":"railyard-j0k.2","depends_on_id":"railyard-j0k","type":"parent-child","created_at":"2026-02-14T20:02:51Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-j0k.2","depends_on_id":"railyard-j0k.1","type":"blocks","created_at":"2026-02-14T20:03:25Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-j0k.2.1","title":"Implement work decomposition patterns","description":"Dispatch prompt guides Claude Code to: create epic per track when work spans tracks, create tasks under each epic, set priorities (backend foundations = higher priority/lower number), use bead types correctly (epic for containers, task for atomic work, spike for research/unknowns). Prompt includes patterns like: backend model → backend handler → frontend consumer. Validate by testing with the auth example from ARCHITECTURE.md.","acceptance_criteria":"Dispatch creates correct hierarchy from auth example. Epic per track. Tasks ordered by priority. Types used correctly. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:52Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:25:16Z","closed_at":"2026-02-15T06:25:16Z","close_reason":"Closed","labels":["decomposition","dispatch","phase-1"],"dependencies":[{"issue_id":"railyard-j0k.2.1","depends_on_id":"railyard-j0k.2","type":"parent-child","created_at":"2026-02-14T20:02:51Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-j0k.2.2","title":"Implement dependency chain creation with cycle detection","description":"Dispatch creates dependencies via ry bead dep add. Prompt enforces ordering: data model before API handler, API handler before frontend consumer, migration before model. After creating all beads, Dispatch runs ry bead dep list on each to verify chain and checks for cycles. If cycles detected, resolves by removing weakest dependency.","acceptance_criteria":"Dependencies created correctly. No cycles in output. Cross-track deps set (frontend blocked by backend). Dispatch verifies its own work. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:53Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:25:16Z","closed_at":"2026-02-15T06:25:16Z","close_reason":"Closed","labels":["decomposition","dispatch","phase-1"],"dependencies":[{"issue_id":"railyard-j0k.2.2","depends_on_id":"railyard-j0k.2","type":"parent-child","created_at":"2026-02-14T20:02:52Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-j0k.3","title":"Dispatch CLI \u0026 Test Suite","description":"CLI command to start Dispatch and tests for decomposition quality. \u003e90% coverage for internal/dispatch/.","acceptance_criteria":"ry dispatch starts agent. Integration tests verify decomposition quality. \u003e90% coverage.","status":"closed","priority":1,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:53Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:35:01Z","closed_at":"2026-02-15T06:35:01Z","close_reason":"Closed","labels":["dispatch","phase-1","testing"],"dependencies":[{"issue_id":"railyard-j0k.3","depends_on_id":"railyard-j0k","type":"parent-child","created_at":"2026-02-14T20:02:53Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-j0k.3","depends_on_id":"railyard-j0k.2","type":"blocks","created_at":"2026-02-14T20:03:26Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-j0k.3.1","title":"Implement ry dispatch CLI command","description":"Cobra subcommand: ry dispatch. Loads config, connects to Dolt, starts dispatch agent in interactive mode. Opens Claude Code in current terminal for direct conversation. User's primary interface for requesting work.","acceptance_criteria":"ry dispatch starts interactive session. User can type requests. Beads created in Dolt. \u003e90% test coverage.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:54Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:35:01Z","closed_at":"2026-02-15T06:35:01Z","close_reason":"Closed","labels":["dispatch","phase-1","testing"],"dependencies":[{"issue_id":"railyard-j0k.3.1","depends_on_id":"railyard-j0k.3","type":"parent-child","created_at":"2026-02-14T20:02:54Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-j0k.3.2","title":"Integration tests for multi-track decomposition","description":"Test: give Dispatch the auth feature request from ARCHITECTURE.md ('Add user authentication with JWT backend and React login page'). Verify: backend epic created with tasks (model, endpoint, middleware), frontend epic created with tasks (login page, auth context, protected route), cross-track deps (frontend tasks blocked by backend JWT endpoint), all beads have title+description+acceptance+track+type+parent populated.","acceptance_criteria":"Auth decomposition matches ARCHITECTURE.md example. All fields populated. Dependencies correct. No cycles. \u003e90% coverage.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:55Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:35:01Z","closed_at":"2026-02-15T06:35:01Z","close_reason":"Closed","labels":["dispatch","phase-1","testing"],"dependencies":[{"issue_id":"railyard-j0k.3.2","depends_on_id":"railyard-j0k.3","type":"parent-child","created_at":"2026-02-14T20:02:54Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-ks9","title":"Standardize dispatch-to-yardmaster action handling","description":"Epic: Dispatch sends free-form subjects to yardmaster (e.g. 'car xxx was changed try again') but yardmaster's processInbox just acks and logs them without performing any action. Need to define standard action subjects (restart-engine, retry-merge, requeue-car, nudge-engine, unblock-car), implement handlers, and update the dispatch prompt to use standardized subjects. Currently affects: daemon.go processInbox, dispatch/prompt.go, yardmaster.go.","status":"closed","priority":1,"issue_type":"epic","owner":"chris.trower@outlook.com","created_at":"2026-02-17T02:07:22Z","created_by":"Chris Trower","updated_at":"2026-02-17T02:21:10Z","closed_at":"2026-02-17T02:21:10Z","close_reason":"All 5 child tasks complete: configPath threading, action handlers, inbox wiring, dispatch prompt update, and unit tests","dependencies":[{"issue_id":"railyard-ks9","depends_on_id":"railyard-28w","type":"blocks","created_at":"2026-02-16T20:09:21Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-ks9","depends_on_id":"railyard-2ky","type":"blocks","created_at":"2026-02-16T20:09:21Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-ks9","depends_on_id":"railyard-5wk","type":"blocks","created_at":"2026-02-16T20:09:20Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-ks9","depends_on_id":"railyard-blu","type":"blocks","created_at":"2026-02-16T20:09:19Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-ks9","depends_on_id":"railyard-vxg","type":"blocks","created_at":"2026-02-16T20:09:19Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-lba","title":"Bug: Switch merges branches locally but never pushes main to remote","description":"After the yardmaster merges a completed car's branch into main via Switch() in switch.go, there is no git push to the remote. The gitMerge() function (switch.go:232-249) runs git merge --no-ff but stops there. handleCompletedCars() (daemon.go:273) marks the car as merged and creates a reindex job, but never pushes main.\n\nThis means all merges are local-only. In a test project with 8 completed branches, all were merged to main locally but the remote main branch stayed unchanged.\n\nFix: After a successful merge in gitMerge() (or after Switch() returns with Merged=true), push main to the remote. The push should happen after the merge commit so the remote reflects the new state.\n\nOptions:\n1. Add git push origin main to gitMerge() after the merge succeeds\n2. Add a separate gitPush() call in handleCompletedCars after Switch() returns Merged=true\n3. Batch pushes — push once after all completed cars are merged in a single daemon cycle (more efficient)\n\nOption 3 is preferred since multiple cars could be merged in the same cycle and a single push is cleaner than pushing after each merge.\n\nKey files:\n- internal/yardmaster/switch.go — gitMerge() function, Switch() function\n- internal/yardmaster/daemon.go — handleCompletedCars() which calls Switch()\n\nAcceptance criteria:\n- [ ] After merging branch(es) to main, yardmaster pushes main to the remote\n- [ ] Push failures are logged but don't crash the daemon loop\n- [ ] If multiple cars are merged in one cycle, only one push is needed\n- [ ] Add a gitPush helper function\n- [ ] Existing tests still pass (go test ./...)\n- [ ] Add test for the push helper","status":"closed","priority":0,"issue_type":"bug","owner":"chris.trower@outlook.com","created_at":"2026-02-17T04:29:49Z","created_by":"Chris Trower","updated_at":"2026-02-17T04:33:23Z","closed_at":"2026-02-17T04:33:23Z","close_reason":"Added gitPush() helper and batched push in handleCompletedCars after all merges in a cycle. Push failures are non-fatal."}
{"id":"railyard-ldf","title":"Add per-track test_command config to support non-Go languages","description":"switch.go hardcodes 'go test ./...' for merge validation. Add a TestCommand field to TrackConfig so each track can specify its own test runner (e.g. phpunit, pytest, npm test). Default to 'go test ./...' for backward compat when unset. Update runTests() to use the configured command.","status":"closed","priority":1,"issue_type":"bug","owner":"chris.trower@outlook.com","created_at":"2026-02-16T20:39:35Z","created_by":"Chris Trower","updated_at":"2026-02-16T20:41:40Z","closed_at":"2026-02-16T20:41:40Z","close_reason":"Closed"}
{"id":"railyard-lw0","title":"Fix tmux nesting: ry start fails from inside existing tmux session","description":"When running ry start from inside an existing tmux session (e.g. tmux new-session -s term_1), tmux refuses to create nested sessions with 'sessions should be nested with care, unset $TMUX to force'. Fixed by unsetting the TMUX env var on the CreateSession subprocess in tmux_real.go.","status":"closed","priority":1,"issue_type":"bug","owner":"chris.trower@outlook.com","created_at":"2026-02-17T01:50:31Z","created_by":"Chris Trower","updated_at":"2026-02-17T01:50:38Z","closed_at":"2026-02-17T01:50:38Z","close_reason":"Fixed in commit 3ec87a4 — CreateSession now strips TMUX env var from subprocess"}
{"id":"railyard-lwt","title":"Engine Core Loop — Bead Execution Runtime","description":"The heart of Railyard. Engine daemon polls Dolt for ready beads on its track, claims one atomically, renders context (ARCHITECTURE.md Context Injection Template), spawns Claude Code, monitors subprocess, handles exit (done, /clear, stall). The daemon is a Go binary that manages the AI agent lifecycle — it is NOT an AI agent itself. See ARCHITECTURE.md Section Engine Daemon and IMPLEMENTATION_PLAN.md Epic 3.","design":"See ARCHITECTURE.md sections: Engine Daemon — The Core Loop, Context Injection Template, Railyard API (MCP Server or CLI Wrapper)","acceptance_criteria":"ry engine start --track backend claims a ready bead, creates git branch, spawns Claude Code with full context template. On completion pushes branch and goes idle. Handles /clear cycles with progress notes. Detects stalls and escalates. \u003e90% test coverage for internal/engine/.","status":"closed","priority":0,"issue_type":"epic","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:01:49Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:14:06Z","closed_at":"2026-02-15T06:14:06Z","close_reason":"All 5 features complete. Engine daemon: lifecycle, context injection, subprocess management, completion/clear/stall handling, CLI commands, 90.7% test coverage.","labels":["engine","phase-1"],"dependencies":[{"issue_id":"railyard-lwt","depends_on_id":"railyard-5ll","type":"blocks","created_at":"2026-02-14T20:03:04Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-lwt.1","title":"Engine Lifecycle Management","description":"Engine registration in engines table, heartbeat goroutine updating last_activity every 10s, and atomic bead claiming with FOR UPDATE SKIP LOCKED. Foundation for the engine daemon. See ARCHITECTURE.md Engine Daemon section.","acceptance_criteria":"Engine registers on start, deregisters on shutdown. Heartbeat updates every 10s. ClaimBead atomically claims one ready bead per track. Concurrent claims don't double-assign. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:15Z","created_by":"Chris Trower","updated_at":"2026-02-15T05:00:02Z","closed_at":"2026-02-15T05:00:02Z","close_reason":"Implemented engine lifecycle: Register/Deregister/Get, heartbeat goroutine, atomic ClaimBead with FOR UPDATE SKIP LOCKED. 6 unit tests + 22 integration tests, 84% coverage.","labels":["engine","lifecycle","phase-1"],"dependencies":[{"issue_id":"railyard-lwt.1","depends_on_id":"railyard-5ll.2","type":"blocks","created_at":"2026-02-14T20:03:14Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-lwt.1","depends_on_id":"railyard-lwt","type":"parent-child","created_at":"2026-02-14T20:02:14Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-lwt.1.1","title":"Implement engine registration and deregistration","description":"Create internal/engine/engine.go. Register(db *gorm.DB, track string) (*models.Engine, error) — generates engine ID (eng-{5-char-hex}), inserts row: ID, track, role=engine, status=idle, started_at=now. Deregister(db, engineID) error — updates status=dead. Signal handler (SIGINT/SIGTERM) calls Deregister for clean shutdown.","acceptance_criteria":"Register creates engine row in Dolt. Deregister updates status to dead. Signal handler triggers deregister. ID format is eng-xxxxx. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:16Z","created_by":"Chris Trower","updated_at":"2026-02-15T18:36:34Z","closed_at":"2026-02-15T18:36:34Z","close_reason":"Already implemented in earlier session (parent lwt.1 closed)","labels":["engine","lifecycle","phase-1"],"dependencies":[{"issue_id":"railyard-lwt.1.1","depends_on_id":"railyard-lwt.1","type":"parent-child","created_at":"2026-02-14T20:02:15Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-lwt.1.2","title":"Implement heartbeat goroutine","description":"StartHeartbeat(ctx context.Context, db *gorm.DB, engineID string, interval time.Duration) — goroutine that runs UPDATE engines SET last_activity=NOW() WHERE id=engineID every interval (default 10s). Respects context cancellation for clean shutdown. Other components (yardmaster) use stale last_activity to detect dead engines.","acceptance_criteria":"Heartbeat updates last_activity in Dolt every 10s. Stops cleanly on context cancel. Stale detection works (engine with old last_activity detectable). \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:16Z","created_by":"Chris Trower","updated_at":"2026-02-15T18:36:34Z","closed_at":"2026-02-15T18:36:34Z","close_reason":"Already implemented in earlier session (parent lwt.1 closed)","labels":["engine","lifecycle","phase-1"],"dependencies":[{"issue_id":"railyard-lwt.1.2","depends_on_id":"railyard-lwt.1","type":"parent-child","created_at":"2026-02-14T20:02:16Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-lwt.1.3","title":"Implement atomic bead claiming (ClaimBead)","description":"ClaimBead(db *gorm.DB, engineID, track string) (*models.Bead, error) — exactly per ARCHITECTURE.md Section 2: db.Transaction with FOR UPDATE SKIP LOCKED, find first bead WHERE track=X AND status=ready AND assignee IS NULL, ORDER BY priority ASC, created_at ASC, LIMIT 1. Update status=claimed, assignee=engineID, claimed_at=now. Returns nil,nil if no ready beads (not an error). Note: integrates with ReadyBeads logic from Epic 2.","acceptance_criteria":"Claims one bead atomically. Concurrent claims (2 engines same track) don't double-assign. Returns nil when no beads ready. Priority ordering respected. claimed_at set. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:17Z","created_by":"Chris Trower","updated_at":"2026-02-15T18:36:34Z","closed_at":"2026-02-15T18:36:34Z","close_reason":"Already implemented in earlier session (parent lwt.1 closed)","labels":["engine","lifecycle","phase-1"],"dependencies":[{"issue_id":"railyard-lwt.1.3","depends_on_id":"railyard-lwt.1","type":"parent-child","created_at":"2026-02-14T20:02:17Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-lwt.2","title":"Context Injection \u0026 Agent Execution","description":"Context renderer produces full markdown prompt for Claude Code per ARCHITECTURE.md Context Injection Template. Subprocess manager spawns claude CLI, captures I/O to agent_logs. Git branch creation/push for each bead.","acceptance_criteria":"RenderContext produces correct markdown with all sections. Claude Code spawned with context. I/O captured to agent_logs. Git branch created before spawn, pushed after completion. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:18Z","created_by":"Chris Trower","updated_at":"2026-02-15T05:28:02Z","closed_at":"2026-02-15T05:28:02Z","close_reason":"All children complete: context renderer (lwt.2.1), subprocess manager (lwt.2.2), git operations (lwt.2.3)","labels":["context","engine","phase-1"],"dependencies":[{"issue_id":"railyard-lwt.2","depends_on_id":"railyard-lwt","type":"parent-child","created_at":"2026-02-14T20:02:17Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-lwt.2","depends_on_id":"railyard-lwt.1","type":"blocks","created_at":"2026-02-14T20:03:15Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-lwt.2.1","title":"Implement context injection template renderer","description":"Create internal/engine/context.go. RenderContext(bead *models.Bead, track *models.Track, config *config.Config, progress []models.BeadProgress, messages []models.Message) (string, error). Renders full template from ARCHITECTURE.md Context Injection Template section. Sections: track header (name, owner, branch prefix), project conventions (system_prompt, language, conventions), current bead (id, title, priority, branch, description, design_notes, acceptance), previous progress (most recent first), yardmaster messages (unacknowledged), recent commits, completion instructions (ry complete, ry progress), stuck instructions (ry message yardmaster).","acceptance_criteria":"Output matches ARCHITECTURE.md template structure. All sections populated from inputs. Empty progress/messages handled. Markdown well-formed. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:19Z","created_by":"Chris Trower","updated_at":"2026-02-15T05:08:06Z","closed_at":"2026-02-15T05:08:06Z","close_reason":"Implemented context renderer and 16 unit tests, all passing","labels":["context","engine","phase-1"],"dependencies":[{"issue_id":"railyard-lwt.2.1","depends_on_id":"railyard-lwt.2","type":"parent-child","created_at":"2026-02-14T20:02:18Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-lwt.2.2","title":"Implement Claude Code subprocess management","description":"Create internal/engine/subprocess.go. SpawnAgent(ctx context.Context, bead *models.Bead, contextPayload string, db *gorm.DB, engineID string) (*Session, error). Spawns claude CLI with rendered context via --prompt flag or stdin. Captures stdout/stderr in real-time via pipe. Writes to agent_logs table: engine_id, session_id (generated per spawn), bead_id, direction=out, content, created_at. Returns Session handle with PID, stdin pipe, wait channel.","acceptance_criteria":"Claude CLI spawned as subprocess. stdout/stderr captured. agent_logs rows written to Dolt. Session ID unique per spawn. Context cancellation kills subprocess. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:19Z","created_by":"Chris Trower","updated_at":"2026-02-15T05:20:06Z","closed_at":"2026-02-15T05:20:06Z","close_reason":"Subprocess manager implemented with SpawnAgent, Session, logWriter, unit tests (20 pass), integration test","labels":["context","engine","phase-1"],"dependencies":[{"issue_id":"railyard-lwt.2.2","depends_on_id":"railyard-lwt.2","type":"parent-child","created_at":"2026-02-14T20:02:19Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-lwt.2.3","title":"Implement git branch creation and push logic","description":"Create internal/engine/git.go. CreateBranch(branchName string) error — git checkout -b ry/{owner}/{track}/{bead_id} from main. PushBranch(branchName string) error — git push origin {branchName}. RecentCommits(branchName string, n int) ([]string, error) — git log --oneline -n N for context injection. Uses os/exec for git commands. Handles: branch already exists (checkout existing), push failures (retry once).","acceptance_criteria":"Branch created with correct naming convention. Push succeeds to remote. RecentCommits returns last N commits. Existing branch handled gracefully. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:20Z","created_by":"Chris Trower","updated_at":"2026-02-15T05:27:52Z","closed_at":"2026-02-15T05:27:52Z","close_reason":"Git branch creation, push with retry, recent commits implemented with 18 unit tests","labels":["context","engine","phase-1"],"dependencies":[{"issue_id":"railyard-lwt.2.3","depends_on_id":"railyard-lwt.2","type":"parent-child","created_at":"2026-02-14T20:02:20Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-lwt.3","title":"Completion, Progress \u0026 Failure Handling","description":"Handles three outcomes of agent session: (1) bead completed — push branch, go idle; (2) mid-task /clear — write progress note, re-claim; (3) stall/crash — mark stalled, message yardmaster. Per ARCHITECTURE.md Engine Daemon section.","acceptance_criteria":"Completion flow: push branch, mark done, engine idle. Clear cycle: progress note written, same bead re-claimed. Stall: engine stalled, bead blocked, yardmaster notified. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:21Z","created_by":"Chris Trower","updated_at":"2026-02-15T05:59:19Z","closed_at":"2026-02-15T05:59:19Z","close_reason":"All children complete: completion handling, progress notes, stall detection","labels":["completion","engine","phase-1"],"dependencies":[{"issue_id":"railyard-lwt.3","depends_on_id":"railyard-lwt","type":"parent-child","created_at":"2026-02-14T20:02:20Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-lwt.3","depends_on_id":"railyard-lwt.2","type":"blocks","created_at":"2026-02-14T20:03:16Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-lwt.3.1","title":"Implement completion handling","description":"HandleCompletion(db *gorm.DB, bead *models.Bead, engine *models.Engine) error. Called when agent exits and bead status=done. Flow: PushBranch(bead.Branch), write final progress note to bead_progress, set engine status=idle, return (daemon loop picks up next bead). Uses CompleteBead() pattern from ARCHITECTURE.md Section 2.","acceptance_criteria":"Branch pushed on completion. Progress note written. Engine status set to idle. Bead status=done with completed_at timestamp. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:22Z","created_by":"Chris Trower","updated_at":"2026-02-15T05:38:47Z","closed_at":"2026-02-15T05:38:47Z","close_reason":"HandleCompletion and HandleClearCycle implemented with 11 unit tests + 7 integration tests","labels":["completion","engine","phase-1"],"dependencies":[{"issue_id":"railyard-lwt.3.1","depends_on_id":"railyard-lwt.3","type":"parent-child","created_at":"2026-02-14T20:02:21Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-lwt.3.2","title":"Implement progress notes for /clear cycles","description":"HandleClearCycle(db *gorm.DB, bead *models.Bead, engine *models.Engine, cycle int) error. Called when agent exits but bead is NOT done. Writes progress note to bead_progress: cycle number, engine_id, session_id, note (from ry progress output or auto-generated), files_changed (git diff --name-only). Increments cycle counter. Engine re-claims same bead on next loop iteration (do not release to other engines).","acceptance_criteria":"Progress note written with cycle number. Files changed captured from git diff. Same bead re-claimed (not released to pool). Cycle counter increments. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:22Z","created_by":"Chris Trower","updated_at":"2026-02-15T05:38:47Z","closed_at":"2026-02-15T05:38:47Z","close_reason":"HandleCompletion and HandleClearCycle implemented with 11 unit tests + 7 integration tests","labels":["completion","engine","phase-1"],"dependencies":[{"issue_id":"railyard-lwt.3.2","depends_on_id":"railyard-lwt.3","type":"parent-child","created_at":"2026-02-14T20:02:22Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-lwt.3.3","title":"Implement stall detection and escalation","description":"StallDetector monitors subprocess. Conditions: no stdout for 120s (configurable), same error string repeated 3x in output, /clear cycle count exceeds threshold (default 5, configurable). On stall: update engine status=stalled, update bead status=blocked, send message to yardmaster via messaging package with subject 'engine-stalled' and body containing engine ID, bead ID, stall reason, last output snippet.","acceptance_criteria":"Stall detected on: stdout timeout, repeated errors, excessive cycles. Engine marked stalled. Bead marked blocked. Yardmaster message sent with context. Configurable thresholds. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:23Z","created_by":"Chris Trower","updated_at":"2026-02-15T05:48:48Z","closed_at":"2026-02-15T05:48:48Z","close_reason":"Implemented StallDetector with 3 detection modes (stdout timeout, repeated errors, excessive cycles), messaging Send/Inbox/Acknowledge, configurable thresholds, HandleStall escalation. 21 unit tests passing, \u003e90% coverage on detection logic.","labels":["completion","engine","phase-1"],"dependencies":[{"issue_id":"railyard-lwt.3.3","depends_on_id":"railyard-lwt.3","type":"parent-child","created_at":"2026-02-14T20:02:23Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-lwt.4","title":"Engine CLI Commands","description":"CLI commands to start engine daemon and for agents to report completion/progress from within Claude Code sessions.","acceptance_criteria":"ry engine start runs daemon loop. ry complete marks bead done. ry progress writes notes. Clean shutdown on SIGINT. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:24Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:02:27Z","closed_at":"2026-02-15T06:02:27Z","close_reason":"All children complete: engine start daemon and complete/progress commands","labels":["cli","engine","phase-1"],"dependencies":[{"issue_id":"railyard-lwt.4","depends_on_id":"railyard-lwt","type":"parent-child","created_at":"2026-02-14T20:02:23Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-lwt.4","depends_on_id":"railyard-lwt.3","type":"blocks","created_at":"2026-02-14T20:03:16Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-lwt.4.1","title":"Implement ry engine start command (daemon loop)","description":"Cobra subcommand: ry engine start --track backend. Flow: load config, connect to Dolt, register engine, start heartbeat goroutine, enter main loop: (1) check inbox, (2) claim ready bead or re-claim current, (3) render context, (4) create branch, (5) spawn Claude Code, (6) monitor subprocess, (7) handle exit (completion/clear/stall), (8) sleep 5s, (9) repeat. Handle SIGINT/SIGTERM for clean deregister.","acceptance_criteria":"Daemon loop runs continuously. Claims and executes beads. Handles all exit types. Clean shutdown on signal. --track flag required. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:25Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:02:26Z","closed_at":"2026-02-15T06:02:26Z","close_reason":"Implemented ry engine start command with full daemon loop: register, heartbeat, claim, render context, branch, spawn, monitor, handle outcomes, signal shutdown","labels":["cli","engine","phase-1"],"dependencies":[{"issue_id":"railyard-lwt.4.1","depends_on_id":"railyard-lwt.4","type":"parent-child","created_at":"2026-02-14T20:02:24Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-lwt.4.2","title":"Implement ry complete and ry progress commands","description":"ry complete \u003cbead-id\u003e 'summary of what was done' — marks bead status=done, completed_at=now, writes final progress note. Called by agent from within Claude Code session. ry progress \u003cbead-id\u003e 'what I did, what is next' — writes progress note to bead_progress without completing bead. Used before /clear to preserve context for next cycle.","acceptance_criteria":"ry complete transitions bead to done with summary. ry progress writes note without changing status. Both commands work from within Claude Code session. Invalid bead ID returns error. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:25Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:02:27Z","closed_at":"2026-02-15T06:02:27Z","close_reason":"Implemented ry complete and ry progress CLI commands with tests","labels":["cli","engine","phase-1"],"dependencies":[{"issue_id":"railyard-lwt.4.2","depends_on_id":"railyard-lwt.4","type":"parent-child","created_at":"2026-02-14T20:02:25Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-lwt.5","title":"Engine Test Suite","description":"\u003e90% coverage for internal/engine/. Unit tests for context rendering and claim logic. Integration tests with Dolt and mock Claude Code subprocess.","acceptance_criteria":"\u003e90% line coverage for internal/engine/. All tests pass. Mock subprocess for automated testing. Integration tests with Dolt.","status":"closed","priority":1,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:26Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:13:56Z","closed_at":"2026-02-15T06:13:56Z","close_reason":"90.7% coverage achieved (\u003e90% target). Fixed JSON column bug in outcome.go (FilesChanged must be valid JSON for Dolt). Fixed flaky ID generators (5 hex -\u003e 8 hex). All 40+ engine tests pass including integration tests.","labels":["engine","phase-1","testing"],"dependencies":[{"issue_id":"railyard-lwt.5","depends_on_id":"railyard-lwt","type":"parent-child","created_at":"2026-02-14T20:02:26Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-lwt.5","depends_on_id":"railyard-lwt.4","type":"blocks","created_at":"2026-02-14T20:03:17Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-lwt.5.1","title":"Unit tests for engine components","description":"internal/engine/*_test.go. Test: context renderer produces correct markdown for fresh bead (no progress), bead with 3 progress entries, bead with yardmaster messages. Claim logic returns nil for no ready beads. Stall detection triggers on each condition independently. Engine registration creates correct row. Deregistration updates status.","acceptance_criteria":"All unit tests pass. Context renderer tested for multiple bead states. Claim edge cases covered. Stall conditions individually tested. \u003e90% coverage.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:27Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:13:56Z","closed_at":"2026-02-15T06:13:56Z","close_reason":"90.7% coverage achieved (\u003e90% target). Fixed JSON column bug in outcome.go (FilesChanged must be valid JSON for Dolt). Fixed flaky ID generators (5 hex -\u003e 8 hex). All 40+ engine tests pass including integration tests.","labels":["engine","phase-1","testing"],"dependencies":[{"issue_id":"railyard-lwt.5.1","depends_on_id":"railyard-lwt.5","type":"parent-child","created_at":"2026-02-14T20:02:26Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-lwt.5.2","title":"Integration tests with mock subprocess","description":"Integration tests requiring Dolt. Seed ready bead, start engine, verify: (1) bead claimed, (2) branch created, (3) mock Claude Code (simple script echoing output and exiting) runs, (4) agent_logs written, (5) bead status transitions correct. Test /clear cycle: mock exits without completing, verify progress note written, bead re-claimed. Test stall: mock hangs, verify stall detection triggers.","acceptance_criteria":"Full engine lifecycle tested end-to-end with mock. Claim, execute, complete flow works. Clear cycle flow works. Stall detection flow works. \u003e90% coverage.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:28Z","created_by":"Chris Trower","updated_at":"2026-02-15T06:13:56Z","closed_at":"2026-02-15T06:13:56Z","close_reason":"90.7% coverage achieved (\u003e90% target). Fixed JSON column bug in outcome.go (FilesChanged must be valid JSON for Dolt). Fixed flaky ID generators (5 hex -\u003e 8 hex). All 40+ engine tests pass including integration tests.","labels":["engine","phase-1","testing"],"dependencies":[{"issue_id":"railyard-lwt.5.2","depends_on_id":"railyard-lwt.5","type":"parent-child","created_at":"2026-02-14T20:02:27Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-oj5","title":"Exclude epic cars from engine claiming — epics are not implementable work","description":"## Problem\n\nThe engine `ClaimCar()` query (`internal/engine/claim.go:36`) and `ReadyCars()` (`internal/car/deps.go:73`) have **no type filter**. They find any car with `status=open` and no unresolved blockers, regardless of type.\n\nThis caused a real issue: a frontend track engine picked up an epic car (the only one in ready status). The epic's subtasks were all blocked on backend track work. The engine spawned a Claude Code session that had nothing actionable to do, leading to a stall.\n\n**Epics are container cars** — they group related work but are not directly implementable. An engine should never claim an epic. Epics should auto-close when all their children are done.\n\n### Root Cause\n`ClaimCar()` query:\n```go\nresult := tx.Where(\"status = ? AND (assignee = ? OR assignee IS NULL) AND track = ?\", \"open\", \"\", track).\n    Where(\"id NOT IN (?)\", blockedSub).\n    Order(\"priority ASC, created_at ASC\").\n    Limit(1).\n    Find(\u0026claimed)\n```\nNo `.Where(\"type != ?\", \"epic\")` clause.\n\nSame for `ReadyCars()`:\n```go\nq := db.Where(\"status = ? AND (assignee = ? OR assignee IS NULL)\", \"open\", \"\").\n    Where(\"id NOT IN (?)\", blockedSub)\n```\n\n### Related Issue\nWhen an engine claims a car whose children are all blocked on another track, it stalls with nothing to do. Beyond filtering epics, consider: should the engine be able to unclaim a car and move on if it detects the work is blocked? (This relates to railyard-f3r stalled engine recovery.)\n\n## Changes Required\n\n### 1. Filter epics from ClaimCar (`internal/engine/claim.go`)\nAdd `.Where(\"type != ?\", \"epic\")` to the claim query so engines never claim epics.\n\n### 2. Filter epics from ReadyCars (`internal/car/deps.go`)\nAdd the same filter to `ReadyCars()` so `ry car ready` doesn't show epics as claimable.\n\n### 3. Auto-close epics when children complete (`internal/yardmaster/switch.go`)\nAfter `UnblockDeps()` in the Switch flow, check if the merged car's parent is an epic and all siblings are done. If so, auto-close the epic.\n\n### 4. Consider spike type\nSpikes (research tasks) ARE implementable — engines should be able to claim them. Only exclude `type=epic`.\n\n## Acceptance Criteria\n- [ ] `ClaimCar()` never returns a car with type=epic\n- [ ] `ReadyCars()` never returns a car with type=epic  \n- [ ] Add test in `claim_test.go`: epic car with status=open and no deps is NOT claimed\n- [ ] Add test in `deps_test.go`: epic doesn't appear in ReadyCars results\n- [ ] Epic auto-close: when all children of an epic are done, epic status transitions to done\n- [ ] Existing tests still pass","status":"closed","priority":1,"issue_type":"bug","owner":"chris.trower@outlook.com","created_at":"2026-02-16T21:56:39Z","created_by":"Chris Trower","updated_at":"2026-02-16T22:09:14Z","closed_at":"2026-02-16T22:09:14Z","close_reason":"Filtered epics from ClaimCar and ReadyCars queries, added TryCloseEpic auto-close after merge, added tests"}
{"id":"railyard-p9v","title":"Dashboard car list and car detail views","description":"Build the car list page (with filters) and car detail drill-down page for the dashboard.\n\n## What to build\n\n### Car list page (GET /cars)\n- Query params: ?track=, ?status=, ?type=, ?parent= for filtering\n- Table columns: ID (link), Title (truncated), Status (color-coded badge), Type (badge), Track, Priority, Assignee, Created\n- Sort by priority ASC then created ASC (same as ry car list)\n- Filter controls at top of page (dropdowns or links for track/status/type)\n- Use existing car.List() and car.ListFilters or write dashboard-specific queries\n- Show total count: \"Showing N cars\"\n\n### Car detail page (GET /cars/{id})\n- Header: car ID, title, status badge, type badge, priority\n- Metadata section: track, branch, assignee, created/updated/claimed/completed timestamps\n- Parent link (if has parent) and children list (if epic, show child cars with status)\n- Description, Design Notes, Acceptance Criteria sections (rendered as-is, could support markdown later)\n- Dependencies section: \"Blocked by\" list with links, \"Blocks\" list with links\n- Progress history: chronological list of progress notes with cycle number, engine, timestamp, files changed, commit hash\n- Skip tests indicator if skip_tests=true\n\n### Templates\n- templates/cars.html — car list page\n- templates/car_detail.html — car detail page\n- Both extend base layout with nav highlighting\n\n## Acceptance criteria\n- [ ] GET /cars returns paginated/filtered car list with working filter controls\n- [ ] GET /cars?track=backend filters correctly\n- [ ] GET /cars?status=in_progress filters correctly\n- [ ] GET /cars/{id} shows full car detail with all fields\n- [ ] Car detail shows parent link and children list for epics\n- [ ] Car detail shows dependency relationships with links\n- [ ] Car detail shows progress history\n- [ ] Status badges are color-coded consistently across all pages\n- [ ] Navigation: dashboard → car list → car detail → back\n- [ ] Tests: handler returns 200, filters apply correctly, detail page renders all sections, 404 for unknown car ID","status":"closed","priority":2,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-17T02:07:42Z","created_by":"Chris Trower","updated_at":"2026-02-17T13:35:38Z","closed_at":"2026-02-17T13:35:38Z","close_reason":"Implemented car list page with filter dropdowns (track/status/type) and car detail page with metadata, children, dependencies, and progress history. Added CarList and GetCarDetail query functions, 3 new templates (cars.html, car_detail.html, partials.html), Truncate and DerefTime template funcs, CSS for filters/detail/deps. 7 new tests, 25 total dashboard tests pass.","dependencies":[{"issue_id":"railyard-p9v","depends_on_id":"railyard-55e","type":"blocks","created_at":"2026-02-16T20:10:34Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-qhu","title":"Local Orchestration — ry start Full Railyard","description":"Single command (ry start) brings up entire local railyard: Dolt, Dispatch, Yardmaster, and N engines in tmux. ry stop gracefully shuts down. ry status provides dashboard. Engine count user-controlled (1-100), adjustable dynamically via ry engine scale. See ARCHITECTURE.md Section Local Development Mode and IMPLEMENTATION_PLAN.md Epic 7.","design":"See ARCHITECTURE.md Section Local Development Mode — tmux session layout, startup sequence","acceptance_criteria":"ry start --engines 3 creates tmux session with Dispatch, Yardmaster, 3 engines. ry status shows all healthy. ry stop gracefully shuts down. ry engine scale adjusts count dynamically. \u003e90% test coverage for orchestration logic.","status":"closed","priority":1,"issue_type":"epic","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:01:52Z","created_by":"Chris Trower","updated_at":"2026-02-15T18:29:27Z","closed_at":"2026-02-15T18:29:27Z","close_reason":"Closed","labels":["orchestration","phase-1"],"dependencies":[{"issue_id":"railyard-qhu","depends_on_id":"railyard-cek","type":"blocks","created_at":"2026-02-14T20:03:07Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-qhu","depends_on_id":"railyard-j0k","type":"blocks","created_at":"2026-02-14T20:03:08Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-qhu.1","title":"Lifecycle Commands (start/stop/status)","description":"Core orchestration commands. ry start creates tmux session with Dispatch (pane 0), Yardmaster (pane 1), and N engines. ry stop gracefully shuts down. ry status shows dashboard. See ARCHITECTURE.md Local Development Mode.","acceptance_criteria":"ry start brings up full railyard in tmux. ry stop graceful shutdown. ry status shows dashboard with engines, beads, messages. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:56Z","created_by":"Chris Trower","updated_at":"2026-02-15T18:29:13Z","closed_at":"2026-02-15T18:29:13Z","close_reason":"Closed","labels":["lifecycle","orchestration","phase-1"],"dependencies":[{"issue_id":"railyard-qhu.1","depends_on_id":"railyard-cek.5","type":"blocks","created_at":"2026-02-14T20:03:27Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-qhu.1","depends_on_id":"railyard-j0k.3","type":"blocks","created_at":"2026-02-14T20:03:28Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-qhu.1","depends_on_id":"railyard-qhu","type":"parent-child","created_at":"2026-02-14T20:02:55Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-qhu.1.1","title":"Implement ry start command","description":"Cobra subcommand: ry start [--engines N]. Flow: (1) validate config.yaml, (2) check Dolt running (ps aux for dolt sql-server, or try connect), (3) ry db init if database doesn't exist, (4) create tmux session 'railyard', (5) pane 0: launch ry dispatch, (6) pane 1: launch ry yardmaster, (7) panes 2..N+1: launch ry engine start --track {assigned_track} for each engine. Engine count from --engines flag or sum of track engine_slots. Track assignment per Feature 7.2 logic.","acceptance_criteria":"ry start creates tmux session with all components. All agents register in Dolt. Pane layout correct. Engine count configurable. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:56Z","created_by":"Chris Trower","updated_at":"2026-02-15T18:29:13Z","closed_at":"2026-02-15T18:29:13Z","close_reason":"Closed","labels":["lifecycle","orchestration","phase-1"],"dependencies":[{"issue_id":"railyard-qhu.1.1","depends_on_id":"railyard-qhu.1","type":"parent-child","created_at":"2026-02-14T20:02:56Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-qhu.1.2","title":"Implement ry stop command","description":"ry stop [--timeout 60s]. Flow: (1) send 'drain' broadcast message via messaging package, (2) wait for in-progress beads to complete (poll engines table for status=working, up to timeout), (3) kill all engine processes (tmux send-keys C-c or kill), (4) kill yardmaster, (5) kill dispatch, (6) kill tmux session 'railyard', (7) update all engine statuses to dead in Dolt.","acceptance_criteria":"Graceful shutdown: engines finish current work. Timeout forces kill. All engine statuses updated. Tmux session killed. No orphaned processes. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:57Z","created_by":"Chris Trower","updated_at":"2026-02-15T18:29:13Z","closed_at":"2026-02-15T18:29:13Z","close_reason":"Closed","labels":["lifecycle","orchestration","phase-1"],"dependencies":[{"issue_id":"railyard-qhu.1.2","depends_on_id":"railyard-qhu.1","type":"parent-child","created_at":"2026-02-14T20:02:57Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-qhu.1.3","title":"Implement ry status command","description":"ry status [--watch]. Dashboard output: (1) engine table: ID, track, status, current bead, last activity, uptime. (2) bead summary per track: open/ready/claimed/in_progress/done/blocked counts. (3) message queue depth (unacknowledged count). (4) tmux session status (running/stopped). Table-formatted. --watch refreshes every 5s.","acceptance_criteria":"Dashboard shows all engines with current state. Bead counts per track correct. Message depth shown. --watch refreshes. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:58Z","created_by":"Chris Trower","updated_at":"2026-02-15T18:29:13Z","closed_at":"2026-02-15T18:29:13Z","close_reason":"Closed","labels":["lifecycle","orchestration","phase-1"],"dependencies":[{"issue_id":"railyard-qhu.1.3","depends_on_id":"railyard-qhu.1","type":"parent-child","created_at":"2026-02-14T20:02:57Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-qhu.2","title":"Engine Scaling \u0026 Track Assignment","description":"Dynamic engine count management (1-100). Scale up/down per track. Track assignment proportional to config engine_slots and ready bead counts.","acceptance_criteria":"ry engine scale adjusts count dynamically. Track assignment proportional. Engine list/restart work. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:59Z","created_by":"Chris Trower","updated_at":"2026-02-15T18:29:13Z","closed_at":"2026-02-15T18:29:13Z","close_reason":"Closed","labels":["orchestration","phase-1","scaling"],"dependencies":[{"issue_id":"railyard-qhu.2","depends_on_id":"railyard-qhu","type":"parent-child","created_at":"2026-02-14T20:02:58Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-qhu.2","depends_on_id":"railyard-qhu.1","type":"blocks","created_at":"2026-02-14T20:03:28Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-qhu.2.1","title":"Implement ry engine scale command","description":"ry engine scale --count 5 --track backend. Calculates delta between desired and current engine count for the track. Scale up: create new tmux panes, launch ry engine start --track {track}. Scale down: send drain messages to excess engines (LIFO — newest engines drained first), wait for current bead completion, kill panes. Respects max engine_slots per track from config.","acceptance_criteria":"Scale up creates new engine panes. Scale down drains gracefully. Max slots respected. Delta calculation correct. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:02:59Z","created_by":"Chris Trower","updated_at":"2026-02-15T18:29:13Z","closed_at":"2026-02-15T18:29:13Z","close_reason":"Closed","labels":["orchestration","phase-1","scaling"],"dependencies":[{"issue_id":"railyard-qhu.2.1","depends_on_id":"railyard-qhu.2","type":"parent-child","created_at":"2026-02-14T20:02:59Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-qhu.2.2","title":"Implement track assignment logic","description":"AssignTracks(config *config.Config, totalEngines int) map[string]int — distributes N engines across tracks. Algorithm: proportional to engine_slots in config with floor of 1 per active track. Example: backend=5 slots, frontend=3 slots, infra=2 slots, total=10 engines → backend=5, frontend=3, infra=2. If totalEngines \u003c tracks, prioritize by ready bead count. If ready bead counts available, weight toward tracks with more ready beads.","acceptance_criteria":"Proportional distribution correct. Floor of 1 per track. Ready bead weighting works. Edge cases: 1 engine, 100 engines, 0 ready beads. \u003e90% test coverage.","status":"closed","priority":0,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:03:00Z","created_by":"Chris Trower","updated_at":"2026-02-15T18:29:13Z","closed_at":"2026-02-15T18:29:13Z","close_reason":"Closed","labels":["orchestration","phase-1","scaling"],"dependencies":[{"issue_id":"railyard-qhu.2.2","depends_on_id":"railyard-qhu.2","type":"parent-child","created_at":"2026-02-14T20:03:00Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-qhu.2.3","title":"Implement ry engine list and ry engine restart","description":"ry engine list — table showing all engines: ID, track, status, current bead, last activity, uptime (calculated from started_at). Filters: --track, --status. ry engine restart \u003cid\u003e — kills engine's tmux pane (send C-c, wait, kill), engine deregisters via signal handler, creates new tmux pane with same track, new engine registers.","acceptance_criteria":"Engine list shows all engines with correct data. Filters work. Restart kills and recreates cleanly. New engine gets new ID. \u003e90% test coverage.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:03:01Z","created_by":"Chris Trower","updated_at":"2026-02-15T18:29:13Z","closed_at":"2026-02-15T18:29:13Z","close_reason":"Closed","labels":["orchestration","phase-1","scaling"],"dependencies":[{"issue_id":"railyard-qhu.2.3","depends_on_id":"railyard-qhu.2","type":"parent-child","created_at":"2026-02-14T20:03:00Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-qhu.3","title":"Orchestration Test Suite","description":"Integration tests for full lifecycle. \u003e90% coverage for orchestration logic.","acceptance_criteria":"Start/stop lifecycle tested. Engine scaling tested. \u003e90% coverage.","status":"closed","priority":1,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:03:02Z","created_by":"Chris Trower","updated_at":"2026-02-15T18:29:27Z","closed_at":"2026-02-15T18:29:27Z","close_reason":"Closed","labels":["orchestration","phase-1","testing"],"dependencies":[{"issue_id":"railyard-qhu.3","depends_on_id":"railyard-qhu","type":"parent-child","created_at":"2026-02-14T20:03:01Z","created_by":"Chris Trower","metadata":"{}"},{"issue_id":"railyard-qhu.3","depends_on_id":"railyard-qhu.2","type":"blocks","created_at":"2026-02-14T20:03:29Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-qhu.3.1","title":"Integration tests for start/stop lifecycle","description":"Test: ry start --engines 2 creates tmux session with 4 panes (dispatch, yardmaster, 2 engines). Verify tmux session exists. Verify engines registered in Dolt. Verify ry status shows all components. ry stop kills session and updates engine statuses to dead. Verify no orphaned processes (ps check).","acceptance_criteria":"Full lifecycle tested. Tmux session verified. Engine registration verified. Clean shutdown verified. No orphans. \u003e90% coverage.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:03:02Z","created_by":"Chris Trower","updated_at":"2026-02-15T18:29:27Z","closed_at":"2026-02-15T18:29:27Z","close_reason":"Closed","labels":["orchestration","phase-1","testing"],"dependencies":[{"issue_id":"railyard-qhu.3.1","depends_on_id":"railyard-qhu.3","type":"parent-child","created_at":"2026-02-14T20:03:02Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-qhu.3.2","title":"Integration tests for engine scaling","description":"Test: start with 2 engines, ry engine scale --count 5 --track backend, verify 3 new panes created and 3 new engines registered. Scale down: ry engine scale --count 1 --track backend, verify drain messages sent, excess engines shut down, only 1 remains. Verify track assignment logic with multiple tracks.","acceptance_criteria":"Scale up verified (new panes, new registrations). Scale down verified (drain, shutdown). Track assignment correct. \u003e90% coverage.","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-15T02:03:03Z","created_by":"Chris Trower","updated_at":"2026-02-15T18:29:27Z","closed_at":"2026-02-15T18:29:27Z","close_reason":"Closed","labels":["orchestration","phase-1","testing"],"dependencies":[{"issue_id":"railyard-qhu.3.2","depends_on_id":"railyard-qhu.3","type":"parent-child","created_at":"2026-02-14T20:03:03Z","created_by":"Chris Trower","metadata":"{}"}]}
{"id":"railyard-qu4","title":"Enhance Dispatch prompt with full workflow awareness and conventions guidance","description":"The Dispatch system prompt (internal/dispatch/prompt.go) covers car creation, dependencies, and decomposition rules, but has gaps:\n\n1. **No awareness of test_command**: Dispatch doesn't know about the per-track test_command field, so it can't mention it in car descriptions or remind agents to run the right test runner.\n\n2. **No conventions injection**: The prompt template renders track names, languages, file_patterns, and engine_slots — but NOT the conventions map. Dispatch should see what conventions are configured (e.g., 'framework: Laravel 11', 'style: PSR-12') so it can reference them in car descriptions it generates.\n\n3. **No guidance on car description quality**: Dispatch creates cars but has no explicit rules about what makes a good description. It should be told to include: specific file paths, error handling expectations, test coverage requirements, and references to track conventions.\n\n4. **No bug/spike workflow**: Dispatch only shows epic and task examples. It should know when to create spikes (research unknowns before committing to implementation) and how to create bug cars when the user reports issues.\n\n5. **No awareness of engine capabilities**: Dispatch doesn't know that engines can split work, file bugs, or ask yardmaster for help. This context would help Dispatch create better-scoped cars (not too large, not too small).\n\nAcceptance criteria:\n- [ ] Add conventions rendering to the prompt template (iterate .Tracks[].Conventions and display them)\n- [ ] Add test_command to the track info section\n- [ ] Add a 'Writing Good Car Descriptions' section with rules: include file paths, specify test expectations, reference conventions, define edge cases and error handling\n- [ ] Add spike and bug type examples to the decomposition rules\n- [ ] Add a brief note about engine capabilities (can split work, file bugs, message yardmaster) so Dispatch sizes cars appropriately\n- [ ] Update the prompt template test in dispatch_test.go (if exists) or add one verifying conventions appear in output\n- [ ] Existing tests still pass","status":"closed","priority":2,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-16T21:05:06Z","created_by":"Chris Trower","updated_at":"2026-02-17T03:35:05Z","closed_at":"2026-02-17T03:35:05Z","close_reason":"Implementation complete, all tests passing"}
{"id":"railyard-s6v","title":"Enhance engine instructions for bug detection and issue creation","description":"Currently engine context (internal/engine/context.go writeInstructions()) has three sections: 'When You're Done', 'If You're Stuck', and 'If You Need to Split Work'. The split work section only mentions creating child tasks. Engines should also know when and how to create bug issues for problems they discover that are outside the scope of their current car.\n\nExamples of when an engine should file a bug:\n- Discovers a failing test in code they didn't write\n- Finds an API inconsistency between modules  \n- Encounters a broken dependency or import\n- Notices a security issue in existing code\n- Finds that acceptance criteria for a completed car weren't actually met\n\nThe engine should NOT file bugs for problems within their own car's scope — those are just part of the work.\n\nAcceptance criteria:\n- [ ] Add a new '## If You Discover a Bug' section to writeInstructions() in context.go\n- [ ] Include the exact ry car create command with --type bug and example description\n- [ ] Explain the scope rule: file bugs for issues OUTSIDE your car's scope, fix issues INSIDE your car directly\n- [ ] Include ry message send to notify yardmaster when a bug is filed\n- [ ] Add context test in context_test.go verifying the new section appears in rendered output\n- [ ] Existing tests still pass","status":"closed","priority":2,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-16T21:04:48Z","created_by":"Chris Trower","updated_at":"2026-02-17T03:35:05Z","closed_at":"2026-02-17T03:35:05Z","close_reason":"Implementation complete, all tests passing"}
{"id":"railyard-s9f","title":"Add real human notification mechanism for escalations","description":"## Problem\n\nCurrently yardmaster escalation to humans is just a DB message:\n```\nry message send --from yardmaster --to human --subject \"escalate\" --body \"...\"\n```\n\nThis message sits in the Dolt `messages` table until someone manually runs `ry inbox --agent human`. There is no push notification, no terminal alert, no external integration. In practice, the human never sees the escalation unless they're actively polling.\n\n## What's Needed\n\nA notification mechanism that actually reaches the human operator. Options (not mutually exclusive):\n\n### Option A: Terminal notification (minimum viable)\n- When yardmaster sends a message to 'human', write to a visible location: tmux status bar, a dedicated tmux pane, or a desktop notification via `notify-send` / `osascript`\n- Simplest: yardmaster pane prints a prominent banner that the human sees when they check tmux\n- Could also use `tmux display-message` to flash a notification across all panes\n\n### Option B: Webhook integration\n- Add optional `notifications` config section in `railyard.yaml`:\n```yaml\nnotifications:\n  webhook_url: https://hooks.slack.com/services/...\n  # or\n  command: \"notify-send 'Railyard' '{{.Subject}}: {{.Body}}'\"\n```\n- When a message targets 'human' or has priority 'urgent', fire the webhook/command\n- Implementation: `internal/messaging/notify.go` with a `Notify()` function called after `Send()`\n\n### Option C: `ry watch` command\n- A blocking command that streams messages to human in real-time\n- `ry watch --agent human` — polls inbox and prints new messages as they arrive\n- Simpler than webhook, works in any terminal\n\n## Suggested Approach\nStart with Option A (tmux display-message) + Option C (`ry watch`). Webhook can come later.\n\n## Files to Modify\n- `internal/messaging/send.go` — add notification hook after Send()\n- `internal/config/config.go` — add optional NotificationConfig\n- `internal/orchestration/orchestration.go` — possibly add a notification pane\n- `cmd/ry/` — add `ry watch` command\n\n## Acceptance Criteria\n- [ ] When yardmaster escalates to human, the human gets a visible notification\n- [ ] At minimum: tmux display-message shows the escalation text across the session\n- [ ] `ry watch --agent human` command streams incoming messages in real-time\n- [ ] Existing tests still pass\n- [ ] Optional: webhook/command config in railyard.yaml for external notifications","status":"closed","priority":2,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-16T21:56:21Z","created_by":"Chris Trower","updated_at":"2026-02-17T00:20:40Z","closed_at":"2026-02-17T00:20:40Z","close_reason":"Implemented ry watch command + notification hook in messaging.Send()"}
{"id":"railyard-t9o","title":"Add tutorial: Build a Todo app with Railyard","description":"Create a step-by-step quickstart tutorial (docs/tutorial-todo-app.md) that walks through building a Todo List app using Railyard. Covers: project setup, railyard.yaml config, creating cars with dependencies, starting engines, monitoring progress, and merging completed work. Uses concrete examples throughout.","status":"closed","priority":2,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-16T20:32:41Z","created_by":"Chris Trower","updated_at":"2026-02-16T20:34:14Z","closed_at":"2026-02-16T20:34:14Z","close_reason":"Closed"}
{"id":"railyard-tl5","title":"Separate tmux session for dispatch during ry start","description":"When ry start launches tmux panels, put dispatch in its own separate tmux session instead of sharing the main 'railyard' session with engines/yardmaster. This keeps the orchestration view (engines, yardmaster) clean and gives dispatch its own dedicated space. The main session would have engine panes + yardmaster; a second session (e.g. 'railyard-dispatch') would hold the dispatch loop.","status":"closed","priority":2,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-17T01:11:31Z","created_by":"Chris Trower","updated_at":"2026-02-17T01:45:37Z","closed_at":"2026-02-17T01:45:37Z","close_reason":"Dispatch now runs in separate 'railyard-dispatch' tmux session; main 'railyard' session has yardmaster + engines only"}
{"id":"railyard-uno","title":"Implement yardmaster Go daemon loop","description":"Replace Claude-as-main-loop with Go daemon that calls existing functions directly, escalating to Claude only for judgment calls","status":"closed","priority":1,"issue_type":"feature","owner":"chris.trower@outlook.com","created_at":"2026-02-16T21:56:28Z","created_by":"Chris Trower","updated_at":"2026-02-16T22:00:06Z","closed_at":"2026-02-16T22:00:06Z","close_reason":"Implemented yardmaster Go daemon loop with 4-phase monitoring, Claude escalation, tests all passing"}
{"id":"railyard-vxg","title":"Thread configPath through RunDaemon and processInbox","description":"RunDaemon() in daemon.go currently receives (ctx, db, cfg, repoDir, pollInterval, out) but not configPath. RestartEngine() needs configPath to launch replacement engines. Add configPath parameter to RunDaemon() signature and thread it through to processInbox(). Update yardmaster.go Start() to pass opts.ConfigPath into RunDaemon(). Update daemon_test.go TestRunDaemon_* tests for new signature.\n\nFiles: internal/yardmaster/daemon.go, internal/yardmaster/yardmaster.go, internal/yardmaster/daemon_test.go\n\nTest requirements:\n- Existing TestRunDaemon_NilDB, TestRunDaemon_NilConfig, TestRunDaemon_EmptyRepoDir must pass with updated signature\n- go build ./cmd/ry/ compiles\n- go vet ./... clean","status":"closed","priority":1,"issue_type":"task","owner":"chris.trower@outlook.com","created_at":"2026-02-17T02:07:31Z","created_by":"Chris Trower","updated_at":"2026-02-17T02:14:35Z","closed_at":"2026-02-17T02:14:35Z","close_reason":"Added configPath parameter to RunDaemon and processInbox signatures, threaded from StartOpts through to inbox handler"}
{"id":"railyard-yi8","title":"UnblockDeps reports already-open cars as newly unblocked on every sweep","description":"## Bug\nYardmaster daemon logs repeated \"Unblocked car X (dependency Y resolved)\" messages for the same cars every sweep cycle, creating a spam loop.\n\n## Root Cause\nUnblockDeps in switch.go updates cars WHERE status='blocked', which is a no-op for already-open cars. But it always appends the car to the unblocked list regardless of whether the update changed anything. handleBlockedCars then logs each entry.\n\n## Fix\nCheck result.RowsAffected \u003e 0 before reporting a car as newly unblocked.","status":"closed","priority":1,"issue_type":"bug","owner":"chris.trower@outlook.com","created_at":"2026-02-17T04:03:47Z","created_by":"Chris Trower","updated_at":"2026-02-17T04:03:53Z","closed_at":"2026-02-17T04:03:53Z","close_reason":"Fixed: check RowsAffected before reporting car as unblocked"}
{"id":"railyard-yig","title":"Stale car statuses after monolithic epic merge","description":"Cars car-5e6db, car-9bbe2, car-55d7d show as ready/claimed despite their work being merged to main as part of the frontend epic's monolithic commit. Root cause: (1) Switch() in switch.go doesn't update the car's own status after successful merge — it stays 'done' indefinitely. (2) There is no mechanism to detect that a car's branch was merged outside the normal flow (e.g., as part of a parent epic commit). The daemon's handleCompletedCars tracks merged cars in memory but doesn't persist the state. Need: a way to mark cars as fully merged/closed, and a sweep to detect cars whose work is already on main.","status":"closed","priority":1,"issue_type":"bug","owner":"chris.trower@outlook.com","created_at":"2026-02-16T22:17:11Z","created_by":"Chris Trower","updated_at":"2026-02-16T22:20:57Z","closed_at":"2026-02-16T22:20:57Z","close_reason":"Fixed both bugs: added FilesChanged:[] to progress notes, added merged status + reconciliation sweep"}
