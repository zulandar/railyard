# Railyard configuration template
#
# Copy this file to railyard.yaml and edit to match your project.
#
# Quick start:
#   cp railyard.example.yaml railyard.yaml
#   ry db init -c railyard.yaml
#   ry start -c railyard.yaml --engines 2

# ---------------------------------------------------------------------------
# Required
# ---------------------------------------------------------------------------

# Your name or username — used to derive branch prefixes and DB name.
owner: yourname

# Git remote URL for your project.
repo: git@github.com:org/myproject.git

# ---------------------------------------------------------------------------
# Optional — general settings
# ---------------------------------------------------------------------------

# Branch prefix for Railyard-managed branches (default: ry/{owner}).
# branch_prefix: ry/yourname

# Base branch for new cars. When omitted, Railyard auto-detects using:
#   1. Current branch of the primary repo (git symbolic-ref HEAD)
#   2. Remote default branch (origin/HEAD)
#   3. Fallback: 'main'
# Set this explicitly if your repo uses a non-standard default branch
# (e.g. develop, trunk) and you want all cars to target it regardless
# of which branch is currently checked out.
# default_branch: main

# Default acceptance criteria appended to every new car if the car doesn't
# define its own. Useful for org-wide standards like "all tests pass".
# default_acceptance: "All tests pass. No lint warnings."

# When true, completed cars create draft PRs instead of merging directly
# to main. The PR includes a rich description with summary, acceptance
# criteria, design notes, diff stats, and progress notes.
# require_pr: false

# Git attribution: Engine commits include a Co-Authored-By trailer
# (e.g. "Co-Authored-By: Railyard Engine eng-abc123 <railyard-engine@noreply>")
# so you can distinguish engine work from human commits on GitHub.
# Yardmaster merge commits similarly include a Railyard Yardmaster trailer.
# Your git identity (from ~/.gitconfig or PAT) remains the commit author.

# ---------------------------------------------------------------------------
# Dolt database connection (optional — defaults shown)
# ---------------------------------------------------------------------------

# dolt:
#   host: 127.0.0.1
#   port: 3306
#   database: railyard_yourname    # default: railyard_{owner}

# ---------------------------------------------------------------------------
# Stall detection (optional — defaults shown)
# ---------------------------------------------------------------------------

# stall:
#   stdout_timeout_sec: 120    # no stdout for N seconds = engine stall
#   repeated_error_max: 3      # same error N times = engine stall
#   max_clear_cycles: 5        # more than N /clear cycles = engine stall
#   max_switch_failures: 3     # repeated switch (merge/test/push) failures before Claude escalation

# ---------------------------------------------------------------------------
# Notifications (optional)
# ---------------------------------------------------------------------------

# Send desktop notifications when the yardmaster escalates to a human.
# The command is a shell template with {{.Subject}} and {{.Body}} available.
# notifications:
#   command: "notify-send 'Railyard' '{{.Subject}}: {{.Body}}'"

# ---------------------------------------------------------------------------
# Tracks — at least one is required
# ---------------------------------------------------------------------------
#
# Each track defines an area of concern. Engines are assigned to tracks and
# only work on cars belonging to their track. The yardmaster rebalances idle
# engines across tracks automatically.
#
# Fields:
#   name             (required) — unique track identifier
#   language         (required) — primary language (go, typescript, python, etc.)
#   file_patterns    (optional) — glob patterns for files this track owns
#   engine_slots     (optional) — max engines on this track (default: 3)
#   pre_test_command (optional) — shell command run before tests (e.g. "go mod vendor", "npm install")
#   test_command     (optional) — shell command to run tests (default: "go test ./...")
#   conventions      (optional) — key/value pairs injected into engine prompts

tracks:
  - name: backend
    language: go
    file_patterns: ["cmd/**", "internal/**", "pkg/**", "*.go"]
    engine_slots: 3
    test_command: "go test ./..."
    conventions:
      style: "stdlib-first, no frameworks"
      test_framework: "stdlib table-driven"

  # - name: frontend
  #   language: typescript
  #   file_patterns: ["src/**", "*.ts", "*.tsx", "*.css"]
  #   engine_slots: 2
  #   pre_test_command: "npm install"
  #   test_command: "npm test"
  #   conventions:
  #     framework: "Next.js 15"
  #     styling: "Tailwind CSS"

  # - name: api
  #   language: python
  #   file_patterns: ["api/**", "*.py"]
  #   engine_slots: 2
  #   test_command: "pytest"
  #   conventions:
  #     framework: "FastAPI"
  #     style: "PEP 8, type hints required"

  # - name: infra
  #   language: mixed
  #   file_patterns: ["terraform/**", "docker/**", ".github/**", "Makefile"]
  #   engine_slots: 1
  #   test_command: "make lint"

  # - name: mobile
  #   language: swift
  #   file_patterns: ["ios/**", "*.swift"]
  #   engine_slots: 2
  #   test_command: "xcodebuild test -scheme MyApp"
  #   conventions:
  #     min_ios: "17.0"
  #     architecture: "MVVM with Combine"

# ---------------------------------------------------------------------------
# Telegraph chat bridge (optional — Slack or Discord)
# ---------------------------------------------------------------------------
#
# Connects Railyard to a chat platform for command routing, event
# notifications, dispatch via @mention, and scheduled digests.
# See docs/telegraph-setup.md for full setup instructions.
#
# telegraph:
#   platform: slack                    # "slack" or "discord"
#   channel: C0123456789               # default channel ID
#   allowed_channels:                  # restrict bot to these channels (omit for all)
#     - C0123456789
#     - C9876543210
#   slack:
#     bot_token: ${SLACK_BOT_TOKEN}    # xoxb-... bot token
#     app_token: ${SLACK_APP_TOKEN}    # xapp-... app-level token (Socket Mode)
#   # discord:
#   #   bot_token: ${DISCORD_BOT_TOKEN}
#   #   guild_id: "123456789"
#   #   channel_id: "123456789"
#   events:
#     car_lifecycle: true              # post car status changes (default: true)
#     engine_stalls: true              # post stall alerts (default: true)
#     escalations: true                # post escalation messages (default: true)
#     poll_interval_sec: 15            # event poll interval (default: 15)
#   digest:
#     daily:
#       enabled: true
#       cron: "0 9 * * *"             # 9am daily
#     weekly:
#       enabled: true
#       cron: "0 9 * * 1"             # 9am Monday
#   dispatch_lock:
#     heartbeat_interval_sec: 30       # session heartbeat interval (default: 30)
#     heartbeat_timeout_sec: 90        # stale heartbeat threshold (default: 90)
#     queue_max: 5                     # max queued dispatch requests (default: 5)
#   conversations:
#     max_turns: 20                    # max turns per dispatch conversation (default: 20)
#     recovery_lookback_days: 7        # days to look back for session recovery (default: 7)
